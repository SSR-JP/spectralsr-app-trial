"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3690],{9998:function(e,t,r){r.d(t,{Z:function(){return y}});var n=r(9241),a=r(3460),o=r(3098),c=r(8153),i=r(9337),s=r(137),l=r(4593),d=r(2305),u=r(270),p=r(4696),g=r(335),v=r(468),h=r(511),m=r(6548);function y(e){let{onCancel:t}=e,[r]=(0,a.fl)(),y=(0,c.PQ)(c.YI.primary.getArgb(r.scheme));(0,c.PQ)(c.YI.surface.getArgb(r.scheme));let Z=(0,c.PQ)(c.YI.surfaceContainer.getArgb(r.scheme));return(0,n.tZ)(l.Z,{open:!0,css:(0,o.iv)({zIndex:9999,backgroundColor:(0,d.Fq)("#000",.7),backdropFilter:"blur(4px)"}),children:(0,n.tZ)(u.Z,{css:(0,o.iv)({backgroundColor:Z,maxWidth:"400px",width:"90%",margin:"0 16px"}),children:(0,n.BX)(p.Z,{css:(0,o.iv)({display:"flex",flexDirection:"column",alignItems:"center",padding:"32px",textAlign:"center",position:"relative"}),children:[(0,n.tZ)(g.Z,{onClick:t,css:(0,o.iv)({position:"absolute",top:"8px",right:"8px"}),children:(0,n.tZ)(i.Z,{})}),(0,n.tZ)(s.Z,{css:(0,o.iv)({fontSize:"48px",color:y,marginBottom:"16px"})}),(0,n.tZ)(v.Z,{css:(0,o.iv)({color:y,marginBottom:"16px"})}),(0,n.tZ)(h.Z,{variant:"h6",css:(0,o.iv)({marginBottom:"8px"}),children:"決済処理中..."}),(0,n.tZ)(h.Z,{variant:"body1",css:(0,o.iv)({marginBottom:"16px"}),children:"新しいタブで決済を続行してください"}),(0,n.tZ)(h.Z,{variant:"body2",color:"textSecondary",css:(0,o.iv)({marginBottom:"24px"}),children:"決済が完了すると自動的にこの画面は閉じられます"}),(0,n.tZ)(m.Z,{variant:"outlined",onClick:t,css:(0,o.iv)({borderColor:y,color:y}),children:"キャンセル"})]})})})}},6763:function(e,t,r){r.d(t,{Z:function(){return C}});var n=r(9241),a=r(3460),o=r(3098),c=r(8153),i=r(2420),s=r(3959),l=r(1096),d=r(824),u=r(511),p=r(385),g=r(4073),v=r(1326),h=r(4526),m=r(8918),y=r(8784),Z=r(6548),f=r(468),x=r(2265);let b=[{productType:"1",quantity:1,price:100,pricePerTicket:100},{productType:"10",quantity:10,price:1e3,pricePerTicket:100},{productType:"100",quantity:100,price:5e3,pricePerTicket:50,discount:"50%OFF"}];function C(e){let{open:t,onPurchase:r,onCancel:C,purchaseLoading:P=!1}=e,[k]=(0,a.fl)(),[E,T]=(0,x.useState)("1"),w=(0,c.PQ)(c.YI.primary.getArgb(k.scheme)),B=(0,c.PQ)(c.YI.surfaceVariant.getArgb(k.scheme)),I=(0,c.PQ)(c.YI.tertiary.getArgb(k.scheme)),A=e=>"\xa5".concat(e.toLocaleString());return(0,n.BX)(l.Z,{open:t,onClose:C,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:3}},children:[(0,n.BX)(d.Z,{css:(0,o.iv)({display:"flex",alignItems:"center",gap:"8px",paddingBottom:"8px"}),children:[(0,n.tZ)(i.Z,{css:(0,o.iv)({color:w})}),(0,n.tZ)(u.Z,{variant:"h6",component:"span",children:"チケットを購入"})]}),(0,n.BX)(p.Z,{css:(0,o.iv)({paddingTop:"8px"}),children:[(0,n.tZ)(u.Z,{variant:"body1",css:(0,o.iv)({marginBottom:"16px"}),children:"購入するチケットを選択してください"}),(0,n.tZ)(g.Z,{value:E,onChange:e=>T(e.target.value),children:b.map(e=>(0,n.tZ)(v.Z,{css:(0,o.iv)({backgroundColor:E===e.productType?B:"transparent",borderRadius:"8px",padding:"12px 16px",marginBottom:"8px",border:"1px solid ".concat(E===e.productType?w:"rgba(0,0,0,0.12)"),cursor:"pointer",transition:"all 0.2s ease","&:hover":{backgroundColor:B}}),onClick:()=>T(e.productType),children:(0,n.tZ)(h.Z,{value:e.productType,control:(0,n.tZ)(m.Z,{}),label:(0,n.BX)(v.Z,{css:(0,o.iv)({display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%",marginLeft:"8px"}),children:[(0,n.BX)(v.Z,{css:(0,o.iv)({display:"flex",alignItems:"center",gap:"8px"}),children:[(0,n.tZ)(u.Z,{variant:"body1",css:(0,o.iv)({fontWeight:"bold"}),children:1===e.quantity?"".concat(e.quantity,"枚"):"".concat(e.quantity,"枚セット")}),e.discount&&(0,n.BX)(v.Z,{css:(0,o.iv)({display:"flex",alignItems:"center",gap:"4px",backgroundColor:I,color:"white",padding:"2px 8px",borderRadius:"12px",fontSize:"12px",fontWeight:"bold"}),children:[(0,n.tZ)(s.Z,{css:(0,o.iv)({fontSize:"14px"})}),e.discount]})]}),(0,n.tZ)(u.Z,{variant:"body1",css:(0,o.iv)({fontWeight:"bold"}),children:A(e.price)})]}),css:(0,o.iv)({width:"100%",margin:0,"& .MuiFormControlLabel-label":{width:"100%"}})})},e.productType))}),(0,n.tZ)(u.Z,{variant:"body2",color:"textSecondary",css:(0,o.iv)({marginTop:"8px",textAlign:"center"}),children:"※ 購入後のキャンセル・返金はできません"})]}),(0,n.BX)(y.Z,{css:(0,o.iv)({padding:"16px 24px"}),children:[(0,n.tZ)(Z.Z,{onClick:C,color:"inherit",disabled:P,children:"キャンセル"}),(0,n.tZ)(Z.Z,{onClick:()=>{r(E)},variant:"contained",startIcon:P?(0,n.tZ)(f.Z,{size:20,color:"inherit"}):(0,n.tZ)(i.Z,{}),disabled:P,css:(0,o.iv)({backgroundColor:w}),children:P?"準備中...":"購入する"})]})]})}},415:function(e,t,r){r.d(t,{e:function(){return n}});let n={isProdTrialMode:!0}},6091:function(e,t,r){r.d(t,{s:function(){return c}});var n=r(4299),a=r(5041),o=r(2265);let c=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(!1),[c,i]=(0,o.useState)(!1),s=(0,o.useRef)(null),l=(0,o.useRef)(null),[d]=(0,n.mN)();return(0,o.useEffect)(()=>("BroadcastChannel"in window&&(l.current=new BroadcastChannel("payment-status"),l.current.onmessage=t=>{if(console.log("Payment message received:",t.data),"PAYMENT_COMPLETE"===t.data.type){var n,o,c;if(r(!1),i(!1),"success"===t.data.status)(0,a.yv)("チケットの購入が完了しました！",{variant:"success"}),null===(n=e.onPaymentSuccess)||void 0===n||n.call(e);else if("cancel"===t.data.status)(0,a.yv)("支払いがキャンセルされました。",{variant:"info"}),null===(o=e.onPaymentCancel)||void 0===o||o.call(e);else if("error"===t.data.status){let t="支払いの処理中にエラーが発生しました。";(0,a.yv)(t,{variant:"error"}),null===(c=e.onPaymentError)||void 0===c||c.call(e,t)}}}),()=>{l.current&&l.current.close()}),[e]),(0,o.useEffect)(()=>{if(!t||!s.current)return;let e=setInterval(()=>{var t;(null===(t=s.current)||void 0===t?void 0:t.closed)&&(clearInterval(e),r(!1),i(!1),console.log("Payment tab was closed by user"))},1e3);return()=>clearInterval(e)},[t]),{waitingForPayment:t,purchaseRunning:c,handlePurchase:(0,o.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"1";i(!0);let n=d.apiGatewayUrl,o=d.apiClient.getAccessToken(),c=window.location.origin;try{if(s.current=window.open("".concat(c,"/payment-prepare"),"_blank"),!s.current)throw Error("新しいタブを開けませんでした。ポップアップブロックを無効にしてください。");r(!0);let l=t=>{if("PAYMENT_PREPARE_READY"===t.data.type)console.log("Payment prepare page is ready"),d();else if("PAYMENT_CANCELED"===t.data.type){var n;console.log("Payment was canceled from prepare page"),r(!1),i(!1),null===(n=e.onPaymentCancel)||void 0===n||n.call(e)}},d=async()=>{try{let e=await fetch("".concat(n,"/payments/checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({success_url:"".concat(c,"/payment-success?session_id={CHECKOUT_SESSION_ID}"),cancel_url:"".concat(c,"/payment-cancel"),productType:t})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();console.log("Checkout Session created:",r);let{checkout_url:a}=r;s.current&&!s.current.closed&&s.current.postMessage({type:"STRIPE_URL",url:a},"*")}catch(n){var l;console.error("Checkout session creation failed:",n),s.current&&!s.current.closed&&s.current.postMessage({type:"PAYMENT_ERROR",message:"決済ページの準備に失敗しました。"},"*");let t="購入に失敗しました。もう一度お試しください。";(0,a.yv)(t,{variant:"error"}),i(!1),r(!1),null===(l=e.onPaymentError)||void 0===l||l.call(e,t)}};window.addEventListener("message",l),setTimeout(()=>{window.removeEventListener("message",l)},6e4)}catch(r){var l;console.error("Purchase failed:",r);let t=r instanceof Error&&r.message.includes("タブ")?r.message:"購入に失敗しました。もう一度お試しください。";(0,a.yv)(t,{variant:"error"}),i(!1),null===(l=e.onPaymentError)||void 0===l||l.call(e,t)}},[d,e]),handleCancelPayment:(0,o.useCallback)(()=>{s.current&&!s.current.closed&&s.current.close(),r(!1),i(!1)},[])}}}}]);