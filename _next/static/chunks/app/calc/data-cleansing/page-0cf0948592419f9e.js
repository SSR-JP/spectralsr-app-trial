(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{9653:function(e,t,r){Promise.resolve().then(r.bind(r,311))},311:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return A}});var n=r(9241),a=r(1096),s=r(1326),o=r(6548),i=r(270),c=r(5982),l=r(824),u=r(2184),d=r(1807),f=r(7300),h=r(7905),p=r(1929),m=r(2265),y=r(6463),g=r(7818),v=r(8812);let x=(0,m.memo)(e=>{let{width:t,height:r,x:a,y:s}=e;return(0,n.tZ)(v.w,{width:t,height:r,xAxis:[{id:"x",data:a}],yAxis:[{id:"y"}],series:[{data:s,showMark:!1}],axisHighlight:{x:"none",y:"none"},margin:{top:20,right:20,bottom:20,left:20},bottomAxis:{axisId:"x",disableLine:!0},leftAxis:{axisId:"y",disableTicks:!0,tickLabelStyle:{transform:"translateX(10px)",textAnchor:"start"}},disableLineItemHighlight:!0})});var Z=r(3457),S=r(2331),b=r(4299),k=r(149),w=r(5041),C=r(4980),P=r(3796);let D=(0,g.default)(()=>Promise.all([r.e(934),r.e(109),r.e(8)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function I(e){var t,r;let{open:i,onClose:c,targetDataNumber:l,originalDataset:u}=e,d=null===(t=u[l])||void 0===t?void 0:t.samplesY,[f]=(0,m.useState)(null===(r=u[l])||void 0===r?void 0:r.samplesX);return(0,n.tZ)(a.Z,{open:i,onClose:c,maxWidth:"lg",children:(0,n.BX)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",minWidth:"600px"},children:[(0,n.tZ)(D,{data:[{x:f,y:d,mode:"lines+markers"}],layout:{}}),(0,n.tZ)(o.Z,{onClick:c,children:"Close"})]})})}function A(){let e=(0,y.useRouter)(),[t]=(0,b.mN)(),r=t.apiClient,[g,v]=(0,C.Ay)(),D=g.originalDataset,{setActiveStep:A}=(0,S.b)(),[N,T]=(0,m.useState)("not-loaded"),[_,L]=(0,m.useState)([]),[O,E]=(0,m.useState)(!1),[X,F]=(0,m.useState)(0),B=(0,m.useRef)(null),[Y,G]=(0,m.useState)(!1),[j,R]=(0,m.useState)(!1),[Q,M]=(0,m.useState)(0),[z,H]=(0,m.useState)(0);async function W(){if("loaded"==g.status){T("loaded");return}try{let e=await r.serviceFetch("dataset",[],{method:"GET"}),t=await e.json();if(v.setName(t.name),""===t.name){T("not-loaded");return}let n=await r.serviceFetch("dataset/groups/current",[],{method:"GET"}),a=await n.json();if(null===a){let e=await r.serviceFetch("dataset/groups",[],{method:"GET"}),t=await e.json();L(t),T("group-unset");return}T("loaded"),t.number_of_data>0&&R(!0),M(t.number_of_data);let s=[];H(0);for(let e=0;e<t.number_of_data;e++){let t=await r.serviceFetch("dataset/data/".concat(e),[]),n=await t.json();H(e),s.push({samplesX:n.samples.map(e=>e[0]),samplesY:n.samples.map(e=>e[1]),using:n.using})}R(!1),v.setOriginalDataset(s),v.setDatasetStatus("loaded");let o=await r.serviceFetch("dataset/ssr/results",[]);if(!o.ok)throw Error("resultResponse is not ok");let{number_of_results:i}=await o.json();v.setIsLocked(i>0)}catch(e){R(!1),(0,w.yv)("データの読み込みに失敗しました",{variant:"error"}),console.error(e)}}async function J(e){let t=new FormData;t.append("file",e);try{G(!0);let e=await r.serviceFetch("dataset",[],{method:"POST",body:t});if(!e.ok){let t=await (0,b.NZ)(e);(0,w.yv)(t,{variant:"error",action:P.D,persist:!0}),G(!1);return}G(!1),await W()}catch(e){G(!1),console.error(e),(0,w.yv)("サーバとの通信に失敗しました",{variant:"error"})}}(0,m.useEffect)(()=>{A(0)},[]),(0,m.useEffect)(()=>{console.log("!!!!",t.serviceStatus);let r=t.serviceStatus;"connected"===r?W():"not-login"===r&&e.push("/login")},[t.serviceStatus]);let[U,q,K]="configuring"===t.serviceStatus?[!0,"サービスと接続中",""]:Y?[!0,"ファイルをアップロード中",""]:j?[!0,"データを読み込み中","".concat(z," / ").concat(Q)]:[!1,""],V=(0,m.useMemo)(()=>D.map((e,t)=>{let{samplesX:a,samplesY:s,using:o}=e;return(0,n.BX)(i.Z,{sx:{width:"200px",height:"150px",position:"relative"},children:[(0,n.tZ)(p.Z,{disabled:g.isLocked,checked:o,sx:{position:"absolute",right:0},onChange:e=>{let n=[...D];n[t].using=e.target.checked,v.setOriginalDataset(n),r.serviceFetch("dataset/data/".concat(t),[],{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({using:e.target.checked})})}}),(0,n.tZ)(c.Z,{onClick:()=>{F(t),E(!0)},children:(0,n.tZ)(x,{width:200,height:150,x:a,y:s})})]},t)}),[D,g.isLocked]);return(0,n.BX)(Z.T,{onNext:()=>{"loaded"===g.status&&e.push("/calc/fitting")},children:["not-loaded"===N?(0,n.BX)(s.Z,{sx:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[(0,n.tZ)(o.Z,{variant:"contained",onClick:()=>{B.current&&(B.current.value="",B.current.click())},children:"計測ファイルを開く"}),(0,n.tZ)("input",{ref:B,hidden:!0,type:"file",onChange:e=>{let{files:t}=e.target;t&&0!==t.length&&J(t[0])}})]}):"group-unset"===N?(0,n.BX)(a.Z,{open:!0,children:[(0,n.tZ)(l.Z,{children:"読み込むデータグループ"}),(0,n.tZ)(u.Z,{children:_.map(e=>(0,n.tZ)(d.ZP,{disableGutters:!0,children:(0,n.tZ)(f.Z,{onClick:()=>{console.log(e),r.serviceFetch("dataset/groups/current",["group_key=".concat(e)],{method:"POST"}).then(()=>(W(),null)).catch(e=>{console.error(e)})},children:(0,n.tZ)(h.Z,{primary:e})})},e))})]}):"loaded"===N?(0,n.tZ)(s.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:V}):null,(0,n.tZ)(I,{open:O,onClose:()=>{E(!1)},originalDataset:D,targetDataNumber:X}),(0,n.tZ)(k.f,{primaryText:q,secondaryText:K,open:U})]})}},2331:function(e,t,r){"use strict";r.d(t,{I:function(){return a},b:function(){return s}});var n=r(2265);let a=n.createContext(void 0),s=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useAppContext must be used within an AppProvider");return e}},3457:function(e,t,r){"use strict";r.d(t,{T:function(){return o}});var n=r(9241),a=r(1326),s=r(6548);function o(e){let{children:t,onNext:r,onBack:o}=e;return(0,n.BX)(a.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflow:"auto",display:"flex",flexDirection:"column"},children:[(0,n.tZ)(a.Z,{sx:{padding:2,overflowY:"overlay",flexGrow:1},children:t}),(0,n.BX)(a.Z,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:[(0,n.tZ)(s.Z,{sx:{m:1},variant:"outlined",onClick:o,disabled:!o,children:"もどる"}),(0,n.tZ)(s.Z,{sx:{m:1},variant:"contained",onClick:r,disabled:!r,children:"つぎへ"})]})]})}o.defaultProps={onNext:void 0,onBack:void 0}},149:function(e,t,r){"use strict";r.d(t,{f:function(){return c}});var n=r(9241),a=r(4593),s=r(1326),o=r(468),i=r(511);function c(e){let{primaryText:t,secondaryText:r,open:c}=e;return(0,n.BX)(a.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,display:"flex",flexDirection:"column"},open:c,style:{transitionDelay:c?"800ms":"0ms"},unmountOnExit:!0,children:[(0,n.BX)(s.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,n.tZ)(o.Z,{color:"inherit"}),(0,n.tZ)(i.Z,{variant:"h6",component:"div",sx:{ml:2},children:t})]}),(0,n.tZ)(i.Z,{variant:"h6",component:"div",children:r})]})}},3796:function(e,t,r){"use strict";r.d(t,{D:function(){return c}});var n=r(9241),a=r(6548),s=r(5041),o=r(3460),i=r(8153);let c=e=>{let[t]=(0,o.fl)();return(0,i.PQ)(i.YI.inversePrimary.getArgb(t.scheme)),(0,n.tZ)(n.HY,{children:(0,n.tZ)(a.Z,{sx:{color:"inherit"},onClick:()=>{(0,s.sy)(e)},children:"Close"})})}},4980:function(e,t,r){"use strict";r.d(t,{Ay:function(){return i},GX:function(){return l}});var n=r(9241),a=r(2265);let s=(0,a.createContext)({status:"unset",name:"",originalDataset:[],isLocked:!0}),o=(0,a.createContext)(()=>{}),i=()=>{let e=(0,a.useContext)(s),t=(0,a.useContext)(o);return[e,(0,a.useMemo)(()=>({setName:e=>{t({type:"setName",payload:e})},setOriginalDataset:e=>{t({type:"setOriginalDataset",payload:e})},setDatasetStatus:e=>{t({type:"setDatasetStatus",payload:e})},setIsLocked:e=>{t({type:"setIsLocked",payload:e})}}),[])]},c=(e,t)=>{switch(t.type){case"setName":return{...e,name:t.payload};case"setOriginalDataset":return{...e,originalDataset:t.payload};case"setDatasetStatus":return{...e,status:t.payload};case"setIsLocked":return{...e,isLocked:t.payload};default:return e}};function l(e){let{children:t}=e,[r,i]=(0,a.useReducer)(c,{status:"unset",name:"",originalDataset:[],isLocked:!0});return(0,n.tZ)(s.Provider,{value:r,children:(0,n.tZ)(o.Provider,{value:i,children:t})})}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return y},NZ:function(){return u},ZP:function(){return s},mN:function(){return p},xh:function(){return o}});var n=r(9241),a=r(2265);let s="ap-northeast-3_K70QvMlqR",o="66f3b23k8hv9ne8poim1b2d8p",i="https://n2cs0lys69.execute-api.ap-northeast-3.amazonaws.com/prod",c="".concat(i,"/services/current"),l={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。"};async function u(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,n=t.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return l[r]||n}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let d=(0,a.createContext)({apiClient:m(i,c,null),apiGatewayUrl:i,serviceStatus:"configuring"}),f=(0,a.createContext)(()=>{}),h=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,p=()=>{let e=(0,a.useContext)(d),t=(0,a.useContext)(f);return(0,a.useRef)(e).current=e,[e,(0,a.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function m(e,t,r){let n=async(e,n,a)=>{r&&n.push("token=".concat(r));let s=n.length>0?"?"+n.join("&"):"";return fetch("".concat(t,"/").concat(e).concat(s),a)};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>n(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await n("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function y(e){let{children:t}=e,r=(0,a.useMemo)(()=>m(i,c,null),[]),[s,o]=(0,a.useReducer)(h,{apiClient:r,apiGatewayUrl:i,serviceStatus:"configuring"}),l=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(!l.current)return async function(){try{let e=await s.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?o({type:"setServiceStatus",payload:{status:"connected"}}):o({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),o({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{l.current=!0}},[]),(0,n.tZ)(d.Provider,{value:s,children:(0,n.tZ)(f.Provider,{value:o,children:t})})}},3460:function(e,t,r){"use strict";r.d(t,{ThemeStoreProvider:function(){return y},fl:function(){return p}});var n=r(9241),a=r(8438),s=r.n(a),o=r(9380),i=r(2686),c=r(1705),l=r(8153),u=r(2265),d=r(1246);let f=(0,u.createContext)({scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),h=(0,u.createContext)(()=>{}),p=()=>{let e=(0,u.useContext)(f),t=(0,u.useContext)(h);return[e,{resetSourceColor:()=>{t({type:"setTheme",payload:{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}})}}]},m=(e,t)=>{if("setTheme"===t.type){let{scheme:r,sourceColor:n}=t.payload;return e.sourceColor===n?e:{...e,scheme:r,sourceColor:n}}return e},y=e=>{let{children:t}=e,[r,a]=(0,u.useReducer)(m,{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),p=(0,o.Z)((0,i.Z)({palette:{mode:"light",primary:{main:(0,l.PQ)(l.YI.primary.getArgb(r.scheme))},secondary:{main:(0,l.PQ)(l.YI.secondary.getArgb(r.scheme))},background:{default:(0,l.PQ)(l.YI.surface.getArgb(r.scheme)),paper:(0,l.PQ)(l.YI.surfaceContainer.getArgb(r.scheme))},error:{main:(0,l.PQ)(l.YI.error.getArgb(r.scheme))},text:{primary:(0,l.PQ)(l.YI.onSurface.getArgb(r.scheme))}},typography:{fontFamily:s().style.fontFamily}}));return(0,n.BX)(c.Z,{theme:p,children:[(0,n.tZ)(d.Z,{styles:e=>({body:{transition:e.transitions.create(["background-color","transform"])}})}),(0,n.tZ)(f.Provider,{value:r,children:(0,n.tZ)(h.Provider,{value:a,children:t})})]})}}},function(e){e.O(0,[665,388,526,41,36,650,2,685,925,878,971,23,744],function(){return e(e.s=9653)}),_N_E=e.O()}]);