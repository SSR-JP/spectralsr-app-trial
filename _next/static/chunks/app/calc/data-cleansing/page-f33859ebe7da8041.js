(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[550],{9653:function(e,t,a){Promise.resolve().then(a.bind(a,311))},311:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return E}});var n=a(9241),i=a(1096),s=a(1326),r=a(6548),o=a(270),l=a(5982),c=a(824),d=a(2184),u=a(1807),h=a(7300),p=a(7905),f=a(1929),m=a(2265),g=a(6463),x=a(7818),Z=a(8812);let v=(0,m.memo)(e=>{let{width:t,height:a,x:i,y:s}=e;return(0,n.tZ)(Z.w,{width:t,height:a,xAxis:[{id:"x",data:i}],yAxis:[{id:"y"}],series:[{data:s,showMark:!1}],axisHighlight:{x:"none",y:"none"},margin:{top:20,right:20,bottom:20,left:20},bottomAxis:{axisId:"x",disableLine:!0},leftAxis:{axisId:"y",disableTicks:!0,tickLabelStyle:{transform:"translateX(10px)",textAnchor:"start"}},disableLineItemHighlight:!0})});var y=a(3457),k=a(2331),w=a(4299),b=a(149),S=a(5041),C=a(4980),_=a(3796);let T=(0,x.default)(()=>Promise.all([a.e(934),a.e(109),a.e(8)]).then(a.bind(a,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function D(e){var t,a;let{open:o,onClose:l,targetDataNumber:c,originalDataset:d}=e,u=null===(t=d[c])||void 0===t?void 0:t.samplesY,[h]=(0,m.useState)(null===(a=d[c])||void 0===a?void 0:a.samplesX);return(0,n.tZ)(i.Z,{open:o,onClose:l,maxWidth:"lg",children:(0,n.BX)(s.Z,{sx:{p:1,display:"flex",flexDirection:"column",minWidth:"600px"},children:[(0,n.tZ)(T,{data:[{x:h,y:u,mode:"lines+markers"}],layout:{}}),(0,n.tZ)(r.Z,{onClick:l,children:"Close"})]})})}function E(){let e=(0,g.useRouter)(),[t]=(0,w.mN)(),a=t.apiClient,[x,Z]=(0,C.Ay)(),T=x.originalDataset,{setActiveStep:E}=(0,k.b)(),[F,N]=(0,m.useState)("not-loaded"),[X,j]=(0,m.useState)([]),[A,O]=(0,m.useState)(!1),[L,P]=(0,m.useState)(0),B=(0,m.useRef)(null),[G,I]=(0,m.useState)(!1),[H,R]=(0,m.useState)(!1),[W,M]=(0,m.useState)(0),[Y,J]=(0,m.useState)(0);async function q(){if("loaded"==x.status){N("loaded");return}try{let e=await a.serviceFetch("dataset",[],{method:"GET"}),t=await e.json();if(Z.setName(t.name),""===t.name){N("not-loaded");return}let n=await a.serviceFetch("dataset/groups/current",[],{method:"GET"}),i=await n.json();if(null===i){let e=await a.serviceFetch("dataset/groups",[],{method:"GET"}),t=await e.json();j(t),N("group-unset");return}N("loaded"),t.number_of_data>0&&R(!0),M(t.number_of_data);let s=[];J(0);for(let e=0;e<t.number_of_data;e++){let t=await a.serviceFetch("dataset/data/".concat(e),[]),n=await t.json();J(e),s.push({samplesX:n.samples.map(e=>e[0]),samplesY:n.samples.map(e=>e[1]),using:n.using})}R(!1),Z.setOriginalDataset(s),Z.setDatasetStatus("loaded");let r=await a.serviceFetch("dataset/ssr/results",[]);if(!r.ok)throw Error("resultResponse is not ok");let{number_of_results:o}=await r.json();Z.setIsLocked(o>0)}catch(e){R(!1),(0,S.yv)("データの読み込みに失敗しました",{variant:"error"}),console.error(e)}}async function z(e){let t=new FormData;t.append("file",e);try{I(!0);let e=await a.serviceFetch("dataset",[],{method:"POST",body:t});if(!e.ok){let t=await (0,w.NZ)(e);(0,S.yv)(t,{variant:"error",action:_.D,persist:!0}),I(!1);return}I(!1),await q()}catch(e){I(!1),console.error(e),(0,S.yv)("サーバとの通信に失敗しました",{variant:"error"})}}(0,m.useEffect)(()=>{E(0)},[]),(0,m.useEffect)(()=>{console.log("!!!!",t.serviceStatus);let a=t.serviceStatus;"connected"===a?q():"not-login"===a&&e.push("/login")},[t.serviceStatus]);let[K,Q,U]="configuring"===t.serviceStatus?[!0,"サービスと接続中",""]:G?[!0,"ファイルをアップロード中",""]:H?[!0,"データを読み込み中","".concat(Y," / ").concat(W)]:[!1,""],V=(0,m.useMemo)(()=>T.map((e,t)=>{let{samplesX:i,samplesY:s,using:r}=e;return(0,n.BX)(o.Z,{sx:{width:"200px",height:"150px",position:"relative"},children:[(0,n.tZ)(f.Z,{disabled:x.isLocked,checked:r,sx:{position:"absolute",right:0},onChange:e=>{let n=[...T];n[t].using=e.target.checked,Z.setOriginalDataset(n),a.serviceFetch("dataset/data/".concat(t),[],{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({using:e.target.checked})})}}),(0,n.tZ)(l.Z,{onClick:()=>{P(t),O(!0)},children:(0,n.tZ)(v,{width:200,height:150,x:i,y:s})})]},t)}),[T,x.isLocked]);return(0,n.BX)(y.T,{onNext:()=>{"loaded"===x.status&&e.push("/calc/fitting")},children:["not-loaded"===F?(0,n.BX)(s.Z,{sx:{height:"100%",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},children:[(0,n.tZ)(r.Z,{variant:"contained",onClick:()=>{B.current&&(B.current.value="",B.current.click())},children:"計測ファイルを開く"}),(0,n.tZ)("input",{ref:B,hidden:!0,type:"file",onChange:e=>{let{files:t}=e.target;t&&0!==t.length&&z(t[0])}})]}):"group-unset"===F?(0,n.BX)(i.Z,{open:!0,children:[(0,n.tZ)(c.Z,{children:"読み込むデータグループ"}),(0,n.tZ)(d.Z,{children:X.map(e=>(0,n.tZ)(u.ZP,{disableGutters:!0,children:(0,n.tZ)(h.Z,{onClick:()=>{console.log(e),a.serviceFetch("dataset/groups/current",["group_key=".concat(e)],{method:"POST"}).then(()=>(q(),null)).catch(e=>{console.error(e)})},children:(0,n.tZ)(p.Z,{primary:e})})},e))})]}):"loaded"===F?(0,n.tZ)(s.Z,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:V}):null,(0,n.tZ)(D,{open:A,onClose:()=>{O(!1)},originalDataset:T,targetDataNumber:L}),(0,n.tZ)(b.f,{primaryText:Q,secondaryText:U,open:K})]})}}},function(e){e.O(0,[665,388,526,41,36,650,2,685,925,878,576,971,23,744],function(){return e(e.s=9653)}),_N_E=e.O()}]);