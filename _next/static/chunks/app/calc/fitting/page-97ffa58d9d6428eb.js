(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{6449:function(e,t,r){Promise.resolve().then(r.bind(r,1393))},1393:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return N}});var a=r(9241),l=r(2960),n=r(1326),i=r(4990),s=r(8549),o=r(7351),c=r(4893),d=r(6557),u=r(8409),h=r(49),f=r(7205),p=r(7894),g=r(2265),m=r(7818),Z=r(5041),y=r(6463),v=r(3098),x=r(2331),w=r(3457),b=r(9278),k=r(4326),B=r(149),S=r(4299),_=r(4980),C=r(3796);let L=(0,m.default)(()=>Promise.all([r.e(934),r.e(109),r.e(8)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function N(){let e=(0,l.Z)(),[t,r]=(0,g.useState)("gaussian"),[m,N]=(0,_.Ay)();(0,g.useRef)(N).current=N;let{setActiveStep:T}=(0,x.b)(),[X]=(0,S.mN)(),R=X.apiClient,E=(0,y.useRouter)(),[F,H]=(0,g.useState)("zoom"),[M,z]=(0,g.useState)([]),[K,O]=(0,g.useState)(0),[P,j]=(0,g.useState)(0),[D,G]=(0,g.useState)(0),[I,A]=(0,g.useState)(0),[J,W]=(0,g.useState)(""),[Y,q]=(0,g.useState)(!1),Q=e=>{W(e),H("select")},U=()=>{W(""),H("zoom")};(0,g.useEffect)(()=>{if(T(1),"loaded"!==m.status){E.push("/");return}let e=m.originalDataset.filter(e=>e.using);if(0===e.length){console.error("No original data."),(0,Z.yv)("No original data.",{variant:"error"});return}let{samplesX:t}=e[0],a=t.map((t,r)=>e.map(e=>e.samplesY[r]).sort((e,t)=>e-t));z((0,b.T)(t,a)),O(t[Math.floor(t.length/6)]),j(t[Math.floor(t.length/6*3)]),G(t[Math.floor(t.length/8*5)]),A(t[Math.floor(t.length/8*7)]),(async()=>{try{let e=await R.serviceFetch("dataset/fitting/settings/latest",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let t=await e.json();if(!t)throw Error("No data");let{fitting_function:a,peak_range:l,noise_range:n}=t;r(a),O(l[0]),j(l[1]),G(n[0]),A(n[1]);return}catch(e){}})()},[]);let V=async()=>{if(m.isLocked){E.push("/calc/ssr-parameter-settings");return}q(!0);try{let e=await R.serviceFetch("dataset/fitting/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fitting_function:t,peak_range:[K,P],noise_range:[D,I]})});if(!e.ok){let t=await (0,S.NZ)(e);(0,Z.yv)(t,{variant:"error",action:C.D,persist:!0}),q(!1);return}E.push("/calc/ssr-parameter-settings"),q(!1)}catch(e){console.error(e),(0,Z.yv)("".concat(e),{variant:"error",action:C.D,persist:!0}),q(!1)}};return(0,a.BX)(w.T,{onNext:V,onBack:()=>E.push("/calc/data-cleansing"),children:[(0,a.BX)(n.Z,{sx:{display:"grid",height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"},gap:1},children:[(0,a.tZ)("div",{css:(0,v.iv)({display:"flex",justifyContent:"center"}),children:(0,a.tZ)(L,{data:M,layout:{width:640,height:400,dragmode:F,shapes:[{type:"rect",xref:"x",yref:"paper",x0:K,y0:0,x1:P,y1:1,fillcolor:e.palette.primary.main,opacity:.2,line:{width:0}},{type:"rect",xref:"x",yref:"paper",x0:D,y0:0,x1:I,y1:1,fillcolor:e.palette.secondary.main,opacity:.2,line:{width:0}}]},onSelected:e=>{let t=[e.range.x[0],e.range.x[1]];"peak"===J?(O(t[0]),j(t[1])):"noise"===J&&(G(t[0]),A(t[1]))}})}),(0,a.BX)(i.Z,{sx:{padding:1},children:[(0,a.BX)(s.Z,{fullWidth:!0,disabled:m.isLocked,children:[(0,a.tZ)(o.Z,{children:"フィッティング関数"}),(0,a.BX)(c.Z,{value:t,onChange:e=>{r(e.target.value)},children:[(0,a.tZ)(d.Z,{value:"gaussian",children:"Gaussian"}),(0,a.tZ)(d.Z,{value:"lorentz",children:"Lorentz"})]})]}),(0,a.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,a.tZ)("span",{children:"フィッティング領域"}),(0,a.tZ)(p.Z,{color:"primary"})]}),(0,a.BX)(h.Z,{children:[(0,a.tZ)(f.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(k.Ki,{label:"左側",disabled:m.isLocked,sx:{mt:1},value:K,onChange:e=>O(e),onFocus:()=>Q("peak"),onBlur:()=>U()})}),(0,a.tZ)(f.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(k.Ki,{label:"右側",disabled:m.isLocked,sx:{mt:1},value:P,onChange:e=>j(e),onFocus:()=>Q("peak"),onBlur:()=>U()})})]}),(0,a.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,a.tZ)("span",{children:"ノイズ領域"}),(0,a.tZ)(p.Z,{color:"secondary"})]}),(0,a.BX)(h.Z,{children:[(0,a.tZ)(f.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(k.Ki,{label:"左側",disabled:m.isLocked,sx:{mt:1},value:D,onChange:e=>G(e),onFocus:()=>Q("noise"),onBlur:()=>U()})}),(0,a.tZ)(f.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(k.Ki,{label:"右側",disabled:m.isLocked,sx:{mt:1},value:I,onChange:e=>A(e),onFocus:()=>Q("noise"),onBlur:()=>U()})})]})]})]}),(0,a.tZ)(B.f,{open:Y})]})}},9278:function(e,t,r){"use strict";r.d(t,{T:function(){return n}});var a=r(2592);function l(e,t){let r=t/100*(e.length-1),a=Math.floor(r),l=a+1,n=r%1;return l>=e.length?e[a]:e[a]*(1-n)+e[l]*n}function n(e,t){let r={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,0)),...t.map(e=>l(e,100)).reverse()],fill:"toself",fillcolor:a.Z[50],line:{width:0},type:"scatter",showlegend:!1},n={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,10)),...t.map(e=>l(e,90)).reverse()],fill:"toself",fillcolor:a.Z[100],line:{width:0},type:"scatter",showlegend:!1},i={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,20)),...t.map(e=>l(e,80)).reverse()],fill:"toself",fillcolor:a.Z[200],line:{width:0},type:"scatter",showlegend:!1};return[r,n,i,{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,30)),...t.map(e=>l(e,70)).reverse()],fill:"toself",fillcolor:a.Z[300],line:{width:0},type:"scatter",showlegend:!1},{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,40)),...t.map(e=>l(e,60)).reverse()],fill:"toself",fillcolor:a.Z[400],line:{width:0},type:"scatter",showlegend:!1},{x:e,y:null==t?void 0:t.map(e=>l(e,50)),mode:"lines",marker:{color:a.Z[500]},showlegend:!1}]}}},function(e){e.O(0,[665,388,526,41,36,650,2,380,685,925,659,169,15,554,276,971,23,744],function(){return e(e.s=6449)}),_N_E=e.O()}]);