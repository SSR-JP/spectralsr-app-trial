(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[524],{6449:function(e,t,r){Promise.resolve().then(r.bind(r,1393))},1393:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return L}});var n=r(9241),l=r(2960),a=r(1326),i=r(4990),o=r(8549),s=r(7351),c=r(4893),d=r(6557),u=r(8409),f=r(49),h=r(7205),p=r(7894),g=r(2265),m=r(7818),y=r(5041),Z=r(6463),v=r(3098),x=r(2331),w=r(3457),b=r(9278),k=r(4326),B=r(149),C=r(4299),N=r(4980),S=r(3796);let _=(0,m.default)(()=>Promise.all([r.e(934),r.e(109),r.e(8)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function L(){let e=(0,l.Z)(),[t,r]=(0,g.useState)("gaussian"),[m,L]=(0,N.Ay)();(0,g.useRef)(L).current=L;let{setActiveStep:F}=(0,x.b)(),[R]=(0,C.mN)(),T=R.apiClient,X=(0,Z.useRouter)(),[E,K]=(0,g.useState)("zoom"),[H,M]=(0,g.useState)([]),[P,z]=(0,g.useState)(0),[D,O]=(0,g.useState)(0),[j,G]=(0,g.useState)(0),[I,A]=(0,g.useState)(0),[J,W]=(0,g.useState)(""),[Y,q]=(0,g.useState)(!1),Q=e=>{W(e),K("select")},U=()=>{W(""),K("zoom")};(0,g.useEffect)(()=>{if(F(1),"loaded"!==m.status){X.push("/");return}let e=m.originalDataset.filter(e=>e.using);if(0===e.length){console.error("No original data."),(0,y.yv)("No original data.",{variant:"error"});return}let{samplesX:t}=e[0],n=t.map((t,r)=>e.map(e=>e.samplesY[r]).sort((e,t)=>e-t));M((0,b.T)(t,n)),z(t[Math.floor(t.length/6)]),O(t[Math.floor(t.length/6*3)]),G(t[Math.floor(t.length/8*5)]),A(t[Math.floor(t.length/8*7)]),(async()=>{try{let e=await T.serviceFetch("dataset/fitting/settings/latest",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let t=await e.json();if(!t)throw Error("No data");let{fitting_function:n,peak_range:l,noise_range:a}=t;r(n),z(l[0]),O(l[1]),G(a[0]),A(a[1]);return}catch(e){}})()},[]);let V=async()=>{if(m.isLocked){X.push("/calc/ssr-parameter-settings");return}q(!0);try{let e=await T.serviceFetch("dataset/fitting/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fitting_function:t,peak_range:[P,D],noise_range:[j,I]})});if(!e.ok){let t=await (0,C.NZ)(e);(0,y.yv)(t,{variant:"error",action:S.D,persist:!0}),q(!1);return}X.push("/calc/ssr-parameter-settings"),q(!1)}catch(e){console.error(e),(0,y.yv)("".concat(e),{variant:"error",action:S.D,persist:!0}),q(!1)}};return(0,n.BX)(w.T,{onNext:V,onBack:()=>X.push("/calc/data-cleansing"),children:[(0,n.BX)(a.Z,{sx:{display:"grid",height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"},gap:1},children:[(0,n.tZ)("div",{css:(0,v.iv)({display:"flex",justifyContent:"center"}),children:(0,n.tZ)(_,{data:H,layout:{width:640,height:400,dragmode:E,shapes:[{type:"rect",xref:"x",yref:"paper",x0:P,y0:0,x1:D,y1:1,fillcolor:e.palette.primary.main,opacity:.2,line:{width:0}},{type:"rect",xref:"x",yref:"paper",x0:j,y0:0,x1:I,y1:1,fillcolor:e.palette.secondary.main,opacity:.2,line:{width:0}}]},onSelected:e=>{let t=[e.range.x[0],e.range.x[1]];"peak"===J?(z(t[0]),O(t[1])):"noise"===J&&(G(t[0]),A(t[1]))}})}),(0,n.BX)(i.Z,{sx:{padding:1},children:[(0,n.BX)(o.Z,{fullWidth:!0,disabled:m.isLocked,children:[(0,n.tZ)(s.Z,{children:"フィッティング関数"}),(0,n.BX)(c.Z,{value:t,onChange:e=>{r(e.target.value)},children:[(0,n.tZ)(d.Z,{value:"gaussian",children:"Gaussian"}),(0,n.tZ)(d.Z,{value:"lorentz",children:"Lorentz"})]})]}),(0,n.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,n.tZ)("span",{children:"フィッティング領域"}),(0,n.tZ)(p.Z,{color:"primary"})]}),(0,n.BX)(f.Z,{children:[(0,n.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(k.Ki,{label:"左側",disabled:m.isLocked,sx:{mt:1},value:P,onChange:e=>z(e),onFocus:()=>Q("peak"),onBlur:()=>U()})}),(0,n.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(k.Ki,{label:"右側",disabled:m.isLocked,sx:{mt:1},value:D,onChange:e=>O(e),onFocus:()=>Q("peak"),onBlur:()=>U()})})]}),(0,n.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,n.tZ)("span",{children:"ノイズ領域"}),(0,n.tZ)(p.Z,{color:"secondary"})]}),(0,n.BX)(f.Z,{children:[(0,n.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(k.Ki,{label:"左側",disabled:m.isLocked,sx:{mt:1},value:j,onChange:e=>G(e),onFocus:()=>Q("noise"),onBlur:()=>U()})}),(0,n.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(k.Ki,{label:"右側",disabled:m.isLocked,sx:{mt:1},value:I,onChange:e=>A(e),onFocus:()=>Q("noise"),onBlur:()=>U()})})]})]})]}),(0,n.tZ)(B.f,{open:Y})]})}},4326:function(e,t,r){"use strict";r.d(t,{Ki:function(){return i},rB:function(){return a}});var n=r(9241),l=r(3983);function a(e){return t=>parseFloat(Number(t).toPrecision(e))}let i=(0,r(2265).forwardRef)(function(e,t){let{label:r,value:a,onChange:i,onBlur:o=()=>{},validator:s,disabled:c,...d}=e,u=null!=s?s:e=>parseFloat(Number(e).toFixed(3));return(0,n.tZ)(l.Z,{disabled:c,ref:t,label:r,value:"number"==typeof a?u(a):a,onChange:e=>{i(e.target.value)},onBlur:e=>{i(u(e.target.value)),null==o||o()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&i(u(t.value))},...d})})},9278:function(e,t,r){"use strict";r.d(t,{T:function(){return a}});var n=r(2592);function l(e,t){let r=t/100*(e.length-1),n=Math.floor(r),l=n+1,a=r%1;return l>=e.length?e[n]:e[n]*(1-a)+e[l]*a}function a(e,t){let r={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,0)),...t.map(e=>l(e,100)).reverse()],fill:"toself",fillcolor:n.Z[50],line:{width:0},type:"scatter",showlegend:!1},a={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,10)),...t.map(e=>l(e,90)).reverse()],fill:"toself",fillcolor:n.Z[100],line:{width:0},type:"scatter",showlegend:!1},i={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,20)),...t.map(e=>l(e,80)).reverse()],fill:"toself",fillcolor:n.Z[200],line:{width:0},type:"scatter",showlegend:!1};return[r,a,i,{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,30)),...t.map(e=>l(e,70)).reverse()],fill:"toself",fillcolor:n.Z[300],line:{width:0},type:"scatter",showlegend:!1},{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,40)),...t.map(e=>l(e,60)).reverse()],fill:"toself",fillcolor:n.Z[400],line:{width:0},type:"scatter",showlegend:!1},{x:e,y:null==t?void 0:t.map(e=>l(e,50)),mode:"lines",marker:{color:n.Z[500]},showlegend:!1}]}}},function(e){e.O(0,[665,388,526,41,36,650,2,380,685,925,659,169,15,554,576,971,23,744],function(){return e(e.s=6449)}),_N_E=e.O()}]);