(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7524],{6449:function(e,t,n){Promise.resolve().then(n.bind(n,1393))},1393:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var r=n(9241),l=n(2960),a=n(1326),i=n(4990),o=n(8549),s=n(7351),c=n(4893),d=n(6557),u=n(8409),f=n(49),h=n(7205),p=n(7894),m=n(2265),g=n(7818),Z=n(5041),y=n(6463),v=n(3098),x=n(2331),w=n(1295),b=n(9278),k=n(4326),B=n(149),C=n(4299),N=n(4980),S=n(3796);let _=(0,g.default)(()=>Promise.all([n.e(5934),n.e(9109),n.e(2008)]).then(n.bind(n,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function L(){let e=(0,l.Z)(),[t,n]=(0,m.useState)("gaussian"),[g,L]=(0,N.Ay)();(0,m.useRef)(L).current=L;let{setActiveStep:X}=(0,x.b)(),[F]=(0,C.mN)(),R=F.apiClient,T=(0,y.useRouter)(),[E,D]=(0,m.useState)("zoom"),[z,K]=(0,m.useState)([]),[H,I]=(0,m.useState)(0),[M,O]=(0,m.useState)(0),[P,j]=(0,m.useState)(0),[G,A]=(0,m.useState)(0),[J,W]=(0,m.useState)(""),[Y,q]=(0,m.useState)(!1),Q=e=>{W(e),D("select")},U=()=>{W(""),D("zoom")};(0,m.useEffect)(()=>{if(X(1),"loaded"!==g.status){T.push("/");return}let e=g.originalDataset.filter(e=>e.using);if(0===e.length){console.error("No original data."),(0,Z.yv)("No original data.",{variant:"error"});return}let{samplesX:t}=e[0],r=t.map((t,n)=>e.map(e=>e.samplesY[n]).sort((e,t)=>e-t));K((0,b.T)(t,r)),I(t[Math.floor(t.length/6)]),O(t[Math.floor(t.length/6*3)]),j(t[Math.floor(t.length/8*5)]),A(t[Math.floor(t.length/8*7)]),(async()=>{try{let e=await R.serviceFetch("dataset/fitting/settings/latest",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let t=await e.json();if(!t)throw Error("No data");let{fitting_function:r,peak_range:l,noise_range:a}=t;n(r),I(l[0]),O(l[1]),j(a[0]),A(a[1]);return}catch(e){}})()},[]);let V=async()=>{if(g.isLocked){T.push("/calc/ssr-parameter-settings");return}q(!0);try{let e=await R.serviceFetch("dataset/fitting/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({fitting_function:t,peak_range:[H,M],noise_range:[P,G]})});if(!e.ok){let t=await (0,C.NZ)(e);(0,Z.yv)(t,{variant:"error",action:S.D,persist:!0}),q(!1);return}T.push("/calc/ssr-parameter-settings"),q(!1)}catch(e){console.error(e),(0,Z.yv)("".concat(e),{variant:"error",action:S.D,persist:!0}),q(!1)}};return(0,r.BX)(w.T,{onNext:V,onBack:()=>T.push("/calc/data-cleansing"),children:[(0,r.BX)(a.Z,{sx:{display:"grid",height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"},gap:1},children:[(0,r.tZ)("div",{css:(0,v.iv)({display:"flex",justifyContent:"center"}),children:(0,r.tZ)(_,{data:z,layout:{width:640,height:400,dragmode:E,shapes:[{type:"rect",xref:"x",yref:"paper",x0:H,y0:0,x1:M,y1:1,fillcolor:e.palette.primary.main,opacity:.2,line:{width:0}},{type:"rect",xref:"x",yref:"paper",x0:P,y0:0,x1:G,y1:1,fillcolor:e.palette.secondary.main,opacity:.2,line:{width:0}}]},onSelected:e=>{let t=[e.range.x[0],e.range.x[1]];"peak"===J?(I(t[0]),O(t[1])):"noise"===J&&(j(t[0]),A(t[1]))}})}),(0,r.BX)(i.Z,{sx:{padding:1},children:[(0,r.BX)(o.Z,{fullWidth:!0,disabled:g.isLocked,children:[(0,r.tZ)(s.Z,{children:"フィッティング関数"}),(0,r.BX)(c.Z,{value:t,onChange:e=>{n(e.target.value)},children:[(0,r.tZ)(d.Z,{value:"gaussian",children:"Gaussian"}),(0,r.tZ)(d.Z,{value:"lorentz",children:"Lorentz"})]})]}),(0,r.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,r.tZ)("span",{children:"フィッティング領域"}),(0,r.tZ)(p.Z,{color:"primary"})]}),(0,r.BX)(f.Z,{children:[(0,r.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,r.tZ)(k.Ki,{label:"左側",disabled:g.isLocked,sx:{mt:1},value:H,onChange:e=>I(e),onFocus:()=>Q("peak"),onBlur:()=>U()})}),(0,r.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,r.tZ)(k.Ki,{label:"右側",disabled:g.isLocked,sx:{mt:1},value:M,onChange:e=>O(e),onFocus:()=>Q("peak"),onBlur:()=>U()})})]}),(0,r.BX)(u.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,r.tZ)("span",{children:"ノイズ領域"}),(0,r.tZ)(p.Z,{color:"secondary"})]}),(0,r.BX)(f.Z,{children:[(0,r.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,r.tZ)(k.Ki,{label:"左側",disabled:g.isLocked,sx:{mt:1},value:P,onChange:e=>j(e),onFocus:()=>Q("noise"),onBlur:()=>U()})}),(0,r.tZ)(h.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,r.tZ)(k.Ki,{label:"右側",disabled:g.isLocked,sx:{mt:1},value:G,onChange:e=>A(e),onFocus:()=>Q("noise"),onBlur:()=>U()})})]})]})]}),(0,r.tZ)(B.f,{open:Y})]})}},4326:function(e,t,n){"use strict";n.d(t,{Ki:function(){return i},rB:function(){return a}});var r=n(9241),l=n(6858);function a(e){return t=>parseFloat(Number(t).toPrecision(e))}let i=(0,n(2265).forwardRef)(function(e,t){let{label:n,value:a,onChange:i,onBlur:o=()=>{},validator:s,disabled:c,...d}=e,u=null!=s?s:e=>parseFloat(Number(e).toFixed(3));return(0,r.tZ)(l.Z,{disabled:c,ref:t,label:n,value:"number"==typeof a?u(a):a,onChange:e=>{i(e.target.value)},onBlur:e=>{i(u(e.target.value)),null==o||o()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&i(u(t.value))},...d})})},149:function(e,t,n){"use strict";n.d(t,{f:function(){return s}});var r=n(9241),l=n(4593),a=n(1326),i=n(468),o=n(511);function s(e){let{primaryText:t,secondaryText:n,open:s}=e;return(0,r.BX)(l.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,display:"flex",flexDirection:"column"},open:s,style:{transitionDelay:s?"800ms":"0ms"},unmountOnExit:!0,children:[(0,r.BX)(a.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,r.tZ)(i.Z,{color:"inherit"}),(0,r.tZ)(o.Z,{variant:"h6",component:"div",sx:{ml:2},children:t})]}),(0,r.tZ)(o.Z,{variant:"h6",component:"div",children:n})]})}},9278:function(e,t,n){"use strict";n.d(t,{T:function(){return a}});var r=n(2592);function l(e,t){let n=t/100*(e.length-1),r=Math.floor(n),l=r+1,a=n%1;return l>=e.length?e[r]:e[r]*(1-a)+e[l]*a}function a(e,t){let n={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,0)),...t.map(e=>l(e,100)).reverse()],fill:"toself",fillcolor:r.Z[50],line:{width:0},type:"scatter",showlegend:!1},a={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,10)),...t.map(e=>l(e,90)).reverse()],fill:"toself",fillcolor:r.Z[100],line:{width:0},type:"scatter",showlegend:!1},i={x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,20)),...t.map(e=>l(e,80)).reverse()],fill:"toself",fillcolor:r.Z[200],line:{width:0},type:"scatter",showlegend:!1};return[n,a,i,{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,30)),...t.map(e=>l(e,70)).reverse()],fill:"toself",fillcolor:r.Z[300],line:{width:0},type:"scatter",showlegend:!1},{x:[...e,...e.toReversed()],y:[...t.map(e=>l(e,40)),...t.map(e=>l(e,60)).reverse()],fill:"toself",fillcolor:r.Z[400],line:{width:0},type:"scatter",showlegend:!1},{x:e,y:null==t?void 0:t.map(e=>l(e,50)),mode:"lines",marker:{color:r.Z[500]},showlegend:!1}]}}},function(e){e.O(0,[1665,9241,526,2036,819,6548,3676,152,4692,972,5380,659,191,7554,6156,2971,7023,1744],function(){return e(e.s=6449)}),_N_E=e.O()}]);