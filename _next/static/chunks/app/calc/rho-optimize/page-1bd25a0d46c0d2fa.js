(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7170],{4437:function(e,t,r){Promise.resolve().then(r.bind(r,1526))},1526:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return K}});var n=r(9241),a=r(2960),o=r(1326),i=r(4990),s=r(4161),c=r(7183),l=r(8409),d=r(49),u=r(7205),h=r(7318),p=r(7818),v=r(3098),m=r(2265),y=r(7575),f=r(5041),g=r(6463),Z=r(4326),x=r(1295),b=r(2331),w=r(4671),C=r(6548),S=r(9128);function I(e){let{loading:t,progressValue:r,progressVariant:a,children:o,sx:i,onClick:s,fullWidth:c,disabled:l}=e;return(0,n.BX)(C.Z,{variant:"contained",sx:{...i},onClick:s,disabled:t||l,fullWidth:c,children:[o,t?(0,n.tZ)(S.Z,{sx:{position:"absolute",bottom:0,left:0,right:0},variant:a,value:r}):null]})}I.defaultProps={progressVariant:"indeterminate",sx:{},fullWidth:void 0,loading:!1,progressValue:0};var B=r(149),k=r(4299),P=r(3796),_=r(4980),R=r(3460),E=r(8153),T=r(1638),D=r(3608),X=r(2420),M=r(1096),A=r(824),F=r(511),N=r(385),z=r(8784),j=r(468);function O(e){let{open:t,ticketBalance:r,requiredTickets:a=1,onConfirm:i,onCancel:s,onPurchase:c,purchaseLoading:l=!1}=e,[d]=(0,R.fl)(),u=(0,E.PQ)(E.YI.primary.getArgb(d.scheme)),p=(0,E.PQ)(E.YI.error.getArgb(d.scheme)),m=(0,E.PQ)(E.YI.surfaceVariant.getArgb(d.scheme)),y=r>=a,f=r-a;return(0,n.BX)(M.Z,{open:t,onClose:s,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiDialog-paper":{borderRadius:3}},children:[(0,n.BX)(A.Z,{css:(0,v.iv)({display:"flex",alignItems:"center",gap:"8px",paddingBottom:"8px"}),children:[y?(0,n.tZ)(T.Z,{css:(0,v.iv)({color:u})}):(0,n.tZ)(D.Z,{css:(0,v.iv)({color:p})}),(0,n.tZ)(F.Z,{variant:"h6",component:"span",children:y?"チケット消費の確認":"チケットが不足しています"})]}),(0,n.tZ)(N.Z,{css:(0,v.iv)({paddingTop:"8px"}),children:y?(0,n.BX)(n.HY,{children:[(0,n.tZ)(F.Z,{variant:"body1",css:(0,v.iv)({marginBottom:"16px"}),children:"SSR計算を開始します。以下のチケットが消費されます。"}),(0,n.BX)(o.Z,{css:(0,v.iv)({backgroundColor:m,borderRadius:"8px",padding:"16px",marginBottom:"16px"}),children:[(0,n.BX)(o.Z,{css:(0,v.iv)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}),children:[(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"現在のチケット残高"}),(0,n.BX)(F.Z,{variant:"body1",css:(0,v.iv)({fontWeight:"bold"}),children:[r,"枚"]})]}),(0,n.BX)(o.Z,{css:(0,v.iv)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}),children:[(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"消費チケット"}),(0,n.BX)(F.Z,{variant:"body1",css:(0,v.iv)({color:p}),children:["-",a,"枚"]})]}),(0,n.tZ)(h.Z,{css:(0,v.iv)({margin:"8px 0"})}),(0,n.BX)(o.Z,{css:(0,v.iv)({display:"flex",justifyContent:"space-between",alignItems:"center"}),children:[(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"計算後の残高"}),(0,n.BX)(F.Z,{variant:"body1",css:(0,v.iv)({fontWeight:"bold"}),children:[f,"枚"]})]})]})]}):(0,n.BX)(n.HY,{children:[(0,n.tZ)(F.Z,{variant:"body1",css:(0,v.iv)({marginBottom:"16px"}),children:"SSR計算を実行するにはチケットが必要です。"}),(0,n.BX)(o.Z,{css:(0,v.iv)({backgroundColor:m,borderRadius:"8px",padding:"16px",marginBottom:"16px"}),children:[(0,n.BX)(o.Z,{css:(0,v.iv)({display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"}),children:[(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"現在のチケット残高"}),(0,n.BX)(F.Z,{variant:"body1",css:(0,v.iv)({color:p}),children:[r,"枚"]})]}),(0,n.BX)(o.Z,{css:(0,v.iv)({display:"flex",justifyContent:"space-between",alignItems:"center"}),children:[(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"必要なチケット"}),(0,n.BX)(F.Z,{variant:"body1",css:(0,v.iv)({fontWeight:"bold"}),children:[a,"枚"]})]})]}),(0,n.tZ)(F.Z,{variant:"body2",color:"textSecondary",children:"チケットを購入してからSSR計算を開始してください。"})]})}),(0,n.BX)(z.Z,{css:(0,v.iv)({padding:"16px 24px"}),children:[(0,n.tZ)(C.Z,{onClick:s,color:"inherit",children:"キャンセル"}),y?(0,n.tZ)(C.Z,{onClick:i,variant:"contained",css:(0,v.iv)({backgroundColor:u}),children:"計算を開始"}):(0,n.tZ)(C.Z,{onClick:c,variant:"contained",startIcon:l?(0,n.tZ)(j.Z,{size:20,color:"inherit"}):(0,n.tZ)(X.Z,{}),disabled:l,css:(0,v.iv)({backgroundColor:u}),children:l?"準備中...":"チケットを購入"})]})]})}var Y=r(9998),L=r(415);let H=()=>{let[e,t]=(0,m.useState)(0),[r,n]=(0,m.useState)(!1),[a]=(0,k.mN)();return{ticketBalance:e,isLoading:r,fetchTicketBalance:(0,m.useCallback)(async()=>{if(L.e.isProdTrialMode){t(999);return}if("connected"!==a.serviceStatus)return;n(!0);let e=a.apiGatewayUrl,r=a.apiClient.getAccessToken();try{let n=await fetch("".concat(e,"/tickets/balance"),{headers:{Authorization:"Bearer ".concat(r)}});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let a=await n.json();t(Math.floor(a.ticket_balance))}catch(e){console.error("Failed to fetch ticket count:",e),(0,f.yv)("チケットの取得に失敗しました。",{variant:"error"})}finally{n(!1)}},[a.serviceStatus,a.apiGatewayUrl,a.apiClient]),updateTicketBalance:(0,m.useCallback)(e=>{t(Math.floor(e))},[])}};var W=r(6091);let G=(0,p.default)(()=>Promise.all([r.e(5934),r.e(9109),r.e(2008)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function K(){let e=(0,g.useRouter)(),[t]=(0,_.Ay)(),[r]=(0,k.mN)(),p=r.apiClient,[C,S]=(0,m.useState)(""),[R,E]=(0,m.useState)(""),[T,D]=(0,m.useState)(""),[X,M]=(0,m.useState)(0),[A,F]=(0,w.P2)(),{setActiveStep:N}=(0,b.b)(),[z,j]=(0,m.useState)(!1),[K,Q]=(0,m.useState)(0),[U,V]=(0,m.useState)([]),[J,q]=(0,m.useState)(!1),[$,ee]=(0,m.useState)("zoom"),{ticketBalance:et,fetchTicketBalance:er,updateTicketBalance:en}=H(),[ea,eo]=(0,m.useState)(!1),[ei,es]=(0,m.useState)(()=>()=>{}),{waitingForPayment:ec,purchaseRunning:el,handlePurchase:ed,handleCancelPayment:eu}=(0,W.s)({onPaymentSuccess:async()=>{await er(),(0,f.yv)("チケットの購入が完了しました",{variant:"success"}),eo(!0)},onPaymentCancel:()=>{console.log("Payment cancelled"),es(()=>()=>{})},onPaymentError:e=>{console.error("Payment error:",e),es(()=>()=>{})}}),[eh,ep]=(0,m.useState)([-6,4]),[ev,em]=(0,m.useState)([0,4]),ey=(0,a.Z)(),ef=()=>{ee("select")},eg=()=>{ee("zoom")};(0,m.useEffect)(()=>{if(N(3),"loaded"!==t.status){e.push("/");return}L.e.isProdTrialMode||er()},[t.status,er]),(0,m.useEffect)(()=>{(async()=>{try{let e=await p.serviceFetch("dataset/ssr/settings/preferred",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let{rho_range:t}=await e.json();S(t[1]),E(t[0])}catch(e){console.error(e)}try{let e=await p.serviceFetch("dataset/rho/optimization/status",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let{steps:t,is_done:r}=await e.json();V(t.map(e=>({iterationNumber:e.iteration_number,rho:e.rho,score:e.score})))}catch(e){console.error(e)}try{let e=await p.serviceFetch("dataset/ssr/settings/latest",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let t=await e.json();if(!t)throw Error("No data");let{rho:r}=t;D(r)}catch(e){console.error(e)}})()},[]),(0,m.useEffect)(()=>{if(!z)return;let e=setInterval(()=>{p.serviceFetch("dataset/rho/optimization/status",[]).then(e=>e.json()).then(t=>{let{steps:r,is_done:n}=t;return V(r.map(e=>({iterationNumber:e.iteration_number,rho:e.rho,score:e.score}))),n&&(clearInterval(e),p.serviceFetch("dataset/rho/best",["range_min=".concat(R),"range_max=".concat(C)]).then(e=>e.json()).then(e=>{let{rho:t}=e;return D(t),j(!1),null}).catch(e=>{console.error(e),(0,f.yv)("".concat(e),{variant:"error"})})),null}).catch(e=>{console.error(e),(0,f.yv)("".concat(e),{variant:"error"})})},1e3);return()=>{clearInterval(e)}},[z,K]);let eZ=(0,m.useMemo)(()=>[{x:U.map(e=>e.rho),y:U.map(e=>e.score),type:"scatter",mode:"markers"}],[U]),ex=async()=>{if(t.isLocked){e.push("/calc/ssr-results");return}if("number"!=typeof T){(0,f.yv)("ρの値を入力してください。",{variant:"error",persist:!0,action:P.D});return}if(L.e.isProdTrialMode){eb(T);return}let r=()=>eb(T);es(()=>r),await er(),eo(!0)},eb=async t=>{q(!0),F.setRho(t);let{optimizeIterations:r,srRange:n,srIntervalDistance:a,searchIntervalDistance:o,searchIterations:i}=A;console.log("!!!",A);try{let s=await p.serviceFetch("dataset/ssr/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({optimize_iterations:r,sr_range:n,sr_interval_distance:a,search_interval_distance:o,search_iterations:i,rho:t})});if(!s.ok){let e=await (0,k.NZ)(s);(0,f.yv)(e,{variant:"error",action:P.D,persist:!0}),q(!1);return}e.push("/calc/ssr-results")}catch(e){console.error(e),(0,f.yv)("".concat(e),{variant:"error",action:P.D,persist:!0}),q(!1)}},ew=z||t.isLocked;return(0,n.BX)(x.T,{onNext:ex,onBack:()=>{e.push("/calc/ssr-parameter-settings")},children:[(0,n.BX)(o.Z,{sx:{display:"grid",height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"},gap:1},children:[(0,n.tZ)("div",{css:(0,v.iv)({display:"flex",justifyContent:"center"}),children:(0,n.tZ)(G,{onUpdate:e=>{ep(e.layout.xaxis.range),em(e.layout.yaxis.range)},data:eZ,layout:{width:640,height:400,dragmode:$,xaxis:{type:"log",exponentformat:"power",autorange:!1,range:eh},yaxis:{type:"log",exponentformat:"power",autorange:!1,range:ev},shapes:[{type:"rect",xref:"x",yref:"paper",x0:R,y0:0,x1:C,y1:1,line:{color:ey.palette.primary.main,width:2,dash:"dash"}}]},onSelected:e=>{E(e.range.x[0]),S(e.range.x[1])}})}),(0,n.BX)(i.Z,{sx:{p:2,overflowY:"scroll",display:"flex",flexDirection:"column"},children:[(0,n.tZ)(o.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,n.BX)(s.Z,{value:X,onChange:(e,t)=>{M(t)},children:[(0,n.tZ)(c.Z,{label:"ρ最適化",sx:{textTransform:"none"},disabled:ew}),(0,n.tZ)(c.Z,{label:"ρ選択",sx:{textTransform:"none"},disabled:ew})]})}),(0,n.BX)(o.Z,{sx:{display:0===X?"block":"none",flexGrow:1,py:3},children:[(0,n.tZ)(l.Z,{component:"legend",sx:{display:"flex",alignItems:"center"},children:(0,n.tZ)("span",{style:{flexGrow:1},children:"最適化範囲"})}),(0,n.BX)(d.Z,{children:[(0,n.tZ)(u.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(Z.Ki,{disabled:ew,label:"最小値",sx:{mt:1},value:R,onChange:e=>{E(e)},validator:(0,Z.rB)(3),onFocus:()=>ef(),onBlur:()=>eg()})}),(0,n.tZ)(u.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(Z.Ki,{disabled:ew,label:"最大値",sx:{mt:1},value:C,onChange:e=>{S(e)},validator:(0,Z.rB)(3),onFocus:()=>ef(),onBlur:()=>eg()})})]}),(0,n.tZ)(I,{sx:{mt:3,overflow:"hidden"},fullWidth:!0,disabled:ew,loading:z,progressVariant:"determinate",progressValue:U.length/K*100,onClick:()=>{j(!0),V([]),p.serviceFetch("dataset/rho/optimization/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({optimize_iterations:A.optimizeIterations,sr_range:A.srRange,sr_interval_distance:A.srIntervalDistance,search_interval_distance:A.searchIntervalDistance,search_iterations:A.searchIterations,rho_range:[R,C]})}).then(e=>e.json()).then(e=>(Q(e.max_iterations),null)).catch(e=>{console.error(e)}).then(()=>null).catch(e=>{console.error(e)})},children:"最適化を開始"})]}),(0,n.BX)(o.Z,{sx:{display:1===X?"block":"none",flexGrow:1,py:3},children:[(0,n.tZ)(l.Z,{component:"legend",sx:{display:"flex",alignItems:"center"},children:(0,n.tZ)("span",{style:{flexGrow:1},children:"選択範囲"})}),(0,n.BX)(d.Z,{children:[(0,n.tZ)(u.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(Z.Ki,{disabled:ew,label:"最小値",sx:{mt:1},value:R,onChange:e=>{E(e)},validator:(0,Z.rB)(3),onFocus:()=>ef(),onBlur:()=>eg()})}),(0,n.tZ)(u.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,n.tZ)(Z.Ki,{disabled:ew,label:"最大値",sx:{mt:1},value:C,onChange:e=>{S(e)},validator:(0,Z.rB)(3),onFocus:()=>ef(),onBlur:()=>eg()})})]}),(0,n.tZ)(I,{disabled:ew,sx:{mt:3},fullWidth:!0,onClick:()=>{p.serviceFetch("dataset/rho/best",["range_min=".concat(R),"range_max=".concat(C)]).then(e=>e.json()).then(e=>{let{rho:t}=e;return D(t),null}).catch(e=>{console.error(e)})},children:"最小値を取得"})]}),(0,n.tZ)(h.Z,{sx:{mt:2}}),(0,n.tZ)(o.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,n.tZ)(y.Z,{color:"action",sx:{transform:"rotate(90deg)",my:2}})}),(0,n.tZ)(Z.Ki,{disabled:ew,label:"使用するρ",fullWidth:!0,value:T,onChange:e=>D(e),validator:(0,Z.rB)(3)})]})]}),(0,n.tZ)(B.f,{primaryText:"SSR実行中",open:J}),(0,n.tZ)(O,{open:ea,ticketBalance:et,requiredTickets:1,onConfirm:()=>{eo(!1),ei&&(ei(),es(()=>()=>{}))},onCancel:()=>{eo(!1),es(()=>()=>{})},onPurchase:()=>{eo(!1),ed()},purchaseLoading:el}),ec&&(0,n.tZ)(Y.Z,{onCancel:eu})]})}},4326:function(e,t,r){"use strict";r.d(t,{Ki:function(){return i},rB:function(){return o}});var n=r(9241),a=r(6858);function o(e){return t=>parseFloat(Number(t).toPrecision(e))}let i=(0,r(2265).forwardRef)(function(e,t){let{label:r,value:o,onChange:i,onBlur:s=()=>{},validator:c,disabled:l,...d}=e,u=null!=c?c:e=>parseFloat(Number(e).toFixed(3));return(0,n.tZ)(a.Z,{disabled:l,ref:t,label:r,value:"number"==typeof o?u(o):o,onChange:e=>{i(e.target.value)},onBlur:e=>{i(u(e.target.value)),null==s||s()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&i(u(t.value))},...d})})},9998:function(e,t,r){"use strict";r.d(t,{Z:function(){return f}});var n=r(9241),a=r(3460),o=r(3098),i=r(8153),s=r(9337),c=r(137),l=r(4593),d=r(2305),u=r(270),h=r(4696),p=r(335),v=r(468),m=r(511),y=r(6548);function f(e){let{onCancel:t}=e,[r]=(0,a.fl)(),f=(0,i.PQ)(i.YI.primary.getArgb(r.scheme));(0,i.PQ)(i.YI.surface.getArgb(r.scheme));let g=(0,i.PQ)(i.YI.surfaceContainer.getArgb(r.scheme));return(0,n.tZ)(l.Z,{open:!0,css:(0,o.iv)({zIndex:9999,backgroundColor:(0,d.Fq)("#000",.7),backdropFilter:"blur(4px)"}),children:(0,n.tZ)(u.Z,{css:(0,o.iv)({backgroundColor:g,maxWidth:"400px",width:"90%",margin:"0 16px"}),children:(0,n.BX)(h.Z,{css:(0,o.iv)({display:"flex",flexDirection:"column",alignItems:"center",padding:"32px",textAlign:"center",position:"relative"}),children:[(0,n.tZ)(p.Z,{onClick:t,css:(0,o.iv)({position:"absolute",top:"8px",right:"8px"}),children:(0,n.tZ)(s.Z,{})}),(0,n.tZ)(c.Z,{css:(0,o.iv)({fontSize:"48px",color:f,marginBottom:"16px"})}),(0,n.tZ)(v.Z,{css:(0,o.iv)({color:f,marginBottom:"16px"})}),(0,n.tZ)(m.Z,{variant:"h6",css:(0,o.iv)({marginBottom:"8px"}),children:"決済処理中..."}),(0,n.tZ)(m.Z,{variant:"body1",css:(0,o.iv)({marginBottom:"16px"}),children:"新しいタブで決済を続行してください"}),(0,n.tZ)(m.Z,{variant:"body2",color:"textSecondary",css:(0,o.iv)({marginBottom:"24px"}),children:"決済が完了すると自動的にこの画面は閉じられます"}),(0,n.tZ)(y.Z,{variant:"outlined",onClick:t,css:(0,o.iv)({borderColor:f,color:f}),children:"キャンセル"})]})})})}},149:function(e,t,r){"use strict";r.d(t,{f:function(){return c}});var n=r(9241),a=r(4593),o=r(1326),i=r(468),s=r(511);function c(e){let{primaryText:t,secondaryText:r,open:c}=e;return(0,n.BX)(a.Z,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1,display:"flex",flexDirection:"column"},open:c,style:{transitionDelay:c?"800ms":"0ms"},unmountOnExit:!0,children:[(0,n.BX)(o.Z,{sx:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,n.tZ)(i.Z,{color:"inherit"}),(0,n.tZ)(s.Z,{variant:"h6",component:"div",sx:{ml:2},children:t})]}),(0,n.tZ)(s.Z,{variant:"h6",component:"div",children:r})]})}},415:function(e,t,r){"use strict";r.d(t,{e:function(){return n}});let n={isProdTrialMode:!0}},6091:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});var n=r(4299),a=r(5041),o=r(2265);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,o.useState)(!1),[i,s]=(0,o.useState)(!1),c=(0,o.useRef)(null),l=(0,o.useRef)(null),[d]=(0,n.mN)();return(0,o.useEffect)(()=>("BroadcastChannel"in window&&(l.current=new BroadcastChannel("payment-status"),l.current.onmessage=t=>{if(console.log("Payment message received:",t.data),"PAYMENT_COMPLETE"===t.data.type){var n,o,i;if(r(!1),s(!1),"success"===t.data.status)(0,a.yv)("チケットの購入が完了しました！",{variant:"success"}),null===(n=e.onPaymentSuccess)||void 0===n||n.call(e);else if("cancel"===t.data.status)(0,a.yv)("支払いがキャンセルされました。",{variant:"info"}),null===(o=e.onPaymentCancel)||void 0===o||o.call(e);else if("error"===t.data.status){let t="支払いの処理中にエラーが発生しました。";(0,a.yv)(t,{variant:"error"}),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}}}),()=>{l.current&&l.current.close()}),[e]),(0,o.useEffect)(()=>{if(!t||!c.current)return;let e=setInterval(()=>{var t;(null===(t=c.current)||void 0===t?void 0:t.closed)&&(clearInterval(e),r(!1),s(!1),console.log("Payment tab was closed by user"))},1e3);return()=>clearInterval(e)},[t]),{waitingForPayment:t,purchaseRunning:i,handlePurchase:(0,o.useCallback)(async()=>{s(!0);let t=d.apiGatewayUrl,n=d.apiClient.getAccessToken(),o=window.location.origin;try{if(c.current=window.open("".concat(o,"/payment-prepare"),"_blank"),!c.current)throw Error("新しいタブを開けませんでした。ポップアップブロックを無効にしてください。");r(!0);let i=t=>{if("PAYMENT_PREPARE_READY"===t.data.type)console.log("Payment prepare page is ready"),l();else if("PAYMENT_CANCELED"===t.data.type){var n;console.log("Payment was canceled from prepare page"),r(!1),s(!1),null===(n=e.onPaymentCancel)||void 0===n||n.call(e)}},l=async()=>{try{let e=await fetch("".concat(t,"/payments/checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({success_url:"".concat(o,"/payment-success?session_id={CHECKOUT_SESSION_ID}"),cancel_url:"".concat(o,"/payment-cancel"),ticketQuantity:1})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();console.log("Checkout Session created:",r);let{checkout_url:a}=r;c.current&&!c.current.closed&&c.current.postMessage({type:"STRIPE_URL",url:a},"*")}catch(n){var i;console.error("Checkout session creation failed:",n),c.current&&!c.current.closed&&c.current.postMessage({type:"PAYMENT_ERROR",message:"決済ページの準備に失敗しました。"},"*");let t="購入に失敗しました。もう一度お試しください。";(0,a.yv)(t,{variant:"error"}),s(!1),r(!1),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}};window.addEventListener("message",i),setTimeout(()=>{window.removeEventListener("message",i)},6e4)}catch(r){var i;console.error("Purchase failed:",r);let t=r instanceof Error&&r.message.includes("タブ")?r.message:"購入に失敗しました。もう一度お試しください。";(0,a.yv)(t,{variant:"error"}),s(!1),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}},[d,e]),handleCancelPayment:(0,o.useCallback)(()=>{c.current&&!c.current.closed&&c.current.close(),r(!1),s(!1)},[])}}},4671:function(e,t,r){"use strict";r.d(t,{L7:function(){return l},P2:function(){return s}});var n=r(9241),a=r(2265);let o=(0,a.createContext)({fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rho:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1}),i=(0,a.createContext)(()=>{}),s=()=>{let e=(0,a.useContext)(o),t=(0,a.useContext)(i);return[e,{setOptimizeIterations:e=>t({type:"setOptimizeIterations",payload:e}),setSrRange:e=>t({type:"setSrRange",payload:e}),setSrIntervalDistance:e=>t({type:"setSrIntervalDistance",payload:e}),setSearchIntervalDistance:e=>t({type:"setSearchIntervalDistance",payload:e}),setSearchIterations:e=>t({type:"setSearchIterations",payload:e}),setRhoMax:e=>t({type:"setRhoMax",payload:e}),setRhoMin:e=>t({type:"setRhoMin",payload:e}),setRho:e=>t({type:"setRho",payload:e})}]},c=(e,t)=>{switch(t.type){case"setFittingFunction":return{...e,fittingFunction:t.payload};case"setOptimizeIterations":return{...e,optimizeIterations:t.payload};case"setSrRange":return console.log("@@@ setSrRange",t.payload),{...e,srRange:t.payload};case"setSrIntervalDistance":return{...e,srIntervalDistance:t.payload};case"setSearchIntervalDistance":return{...e,searchIntervalDistance:t.payload};case"setSearchIterations":return{...e,searchIterations:t.payload};case"setRhoMax":return{...e,rhoMax:t.payload};case"setRhoMin":return{...e,rhoMin:t.payload};case"setRho":return{...e,rho:t.payload};default:throw Error("Invalid action type")}};function l(e){let{children:t}=e,[r,s]=(0,a.useReducer)(c,{fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rho:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1});return(0,n.tZ)(o.Provider,{value:r,children:(0,n.tZ)(i.Provider,{value:s,children:t})})}}},function(e){e.O(0,[1665,9241,526,2036,819,6548,3676,152,4692,972,5380,8273,659,191,6001,6500,6156,2971,7023,1744],function(){return e(e.s=4437)}),_N_E=e.O()}]);