(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[170],{4437:function(e,t,r){Promise.resolve().then(r.bind(r,8519))},8519:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return F}});var a=r(9241),n=r(2960),s=r(1326),o=r(4990),i=r(4161),l=r(7183),c=r(8409),u=r(49),d=r(7205),h=r(7318),p=r(7818),f=r(3098),g=r(2265),v=r(7575),m=r(5041),y=r(6463),x=r(4326),Z=r(3457),b=r(2331),I=r(4671),S=r(6548),w=r(9128);function _(e){let{loading:t,progressValue:r,progressVariant:n,children:s,sx:o,onClick:i,fullWidth:l,disabled:c}=e;return(0,a.BX)(S.Z,{variant:"contained",sx:{...o},onClick:i,disabled:t||c,fullWidth:l,children:[s,t?(0,a.tZ)(w.Z,{sx:{position:"absolute",bottom:0,left:0,right:0},variant:n,value:r}):null]})}_.defaultProps={progressVariant:"indeterminate",sx:{},fullWidth:void 0,loading:!1,progressValue:0};var R=r(149),C=r(4299),B=r(3796),D=r(4980);let k=(0,p.default)(()=>Promise.all([r.e(934),r.e(109),r.e(8)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function F(){let e=(0,y.useRouter)(),[t]=(0,D.Ay)(),[r]=(0,C.mN)(),p=r.apiClient,[S,w]=(0,g.useState)(""),[F,T]=(0,g.useState)(""),[z,M]=(0,g.useState)(""),[P,N]=(0,g.useState)(0),[j,E]=(0,I.P2)(),{setActiveStep:O}=(0,b.b)(),[X,A]=(0,g.useState)(!1),[H,K]=(0,g.useState)(0),[L,G]=(0,g.useState)([]),[W,V]=(0,g.useState)(!1),[J,U]=(0,g.useState)("zoom"),[Y,q]=(0,g.useState)([-6,4]),[Q,$]=(0,g.useState)([0,4]),ee=(0,n.Z)(),et=()=>{U("select")},er=()=>{U("zoom")};(0,g.useEffect)(()=>{if(O(3),"loaded"!==t.status){e.push("/");return}(async()=>{try{let e=await p.serviceFetch("dataset/ssr/settings/preferred",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let{rho_range:t}=await e.json();w(t[1]),T(t[0])}catch(e){console.error(e)}try{let e=await p.serviceFetch("dataset/rho/optimization/status",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let{steps:t,is_done:r}=await e.json();G(t.map(e=>({iterationNumber:e.iteration_number,rho:e.rho,score:e.score})))}catch(e){console.error(e)}try{let e=await p.serviceFetch("dataset/ssr/settings/latest",[]);if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}let t=await e.json();if(!t)throw Error("No data");let{rho:r}=t;M(r)}catch(e){console.error(e)}})()},[]),(0,g.useEffect)(()=>{if(!X)return;let e=setInterval(()=>{p.serviceFetch("dataset/rho/optimization/status",[]).then(e=>e.json()).then(t=>{let{steps:r,is_done:a}=t;return G(r.map(e=>({iterationNumber:e.iteration_number,rho:e.rho,score:e.score}))),a&&(clearInterval(e),p.serviceFetch("dataset/rho/best",["range_min=".concat(F),"range_max=".concat(S)]).then(e=>e.json()).then(e=>{let{rho:t}=e;return M(t),A(!1),null}).catch(e=>{console.error(e),(0,m.yv)("".concat(e),{variant:"error"})})),null}).catch(e=>{console.error(e),(0,m.yv)("".concat(e),{variant:"error"})})},1e3);return()=>{clearInterval(e)}},[X,H]);let ea=(0,g.useMemo)(()=>[{x:L.map(e=>e.rho),y:L.map(e=>e.score),type:"scatter",mode:"markers"}],[L]),en=async()=>{if(t.isLocked){e.push("/calc/ssr-results");return}if("number"!=typeof z){(0,m.yv)("ρの値を入力してください。",{variant:"error",persist:!0,action:B.D});return}V(!0),E.setRho(z);let{optimizeIterations:r,srRange:a,srIntervalDistance:n,searchIntervalDistance:s,searchIterations:o}=j;p.serviceFetch("dataset/ssr/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({optimize_iterations:r,sr_range:a,sr_interval_distance:n,search_interval_distance:s,search_iterations:o,rho:z})}).then(()=>(V(!1),e.push("/calc/ssr-results"),null)).catch(e=>{V(!1),console.error(e)})},es=X||t.isLocked;return(0,a.BX)(Z.T,{onNext:en,onBack:()=>{e.push("/calc/ssr-parameter-settings")},children:[(0,a.BX)(s.Z,{sx:{display:"grid",height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"},gap:1},children:[(0,a.tZ)("div",{css:(0,f.iv)({display:"flex",justifyContent:"center"}),children:(0,a.tZ)(k,{onUpdate:e=>{q(e.layout.xaxis.range),$(e.layout.yaxis.range)},data:ea,layout:{width:640,height:400,dragmode:J,xaxis:{type:"log",exponentformat:"power",autorange:!1,range:Y},yaxis:{type:"log",exponentformat:"power",autorange:!1,range:Q},shapes:[{type:"rect",xref:"x",yref:"paper",x0:F,y0:0,x1:S,y1:1,line:{color:ee.palette.primary.main,width:2,dash:"dash"}}]},onSelected:e=>{T(e.range.x[0]),w(e.range.x[1])}})}),(0,a.BX)(o.Z,{sx:{p:2,overflowY:"scroll",display:"flex",flexDirection:"column"},children:[(0,a.tZ)(s.Z,{sx:{borderBottom:1,borderColor:"divider"},children:(0,a.BX)(i.Z,{value:P,onChange:(e,t)=>{N(t)},children:[(0,a.tZ)(l.Z,{label:"ρ最適化",sx:{textTransform:"none"},disabled:es}),(0,a.tZ)(l.Z,{label:"ρ選択",sx:{textTransform:"none"},disabled:es})]})}),(0,a.BX)(s.Z,{sx:{display:0===P?"block":"none",flexGrow:1,py:3},children:[(0,a.tZ)(c.Z,{component:"legend",sx:{display:"flex",alignItems:"center"},children:(0,a.tZ)("span",{style:{flexGrow:1},children:"最適化範囲"})}),(0,a.BX)(u.Z,{children:[(0,a.tZ)(d.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(x.Ki,{disabled:es,label:"最小値",sx:{mt:1},value:F,onChange:e=>{T(e)},validator:(0,x.rB)(3),onFocus:()=>et(),onBlur:()=>er()})}),(0,a.tZ)(d.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(x.Ki,{disabled:es,label:"最大値",sx:{mt:1},value:S,onChange:e=>{w(e)},validator:(0,x.rB)(3),onFocus:()=>et(),onBlur:()=>er()})})]}),(0,a.tZ)(_,{sx:{mt:3,overflow:"hidden"},fullWidth:!0,disabled:es,loading:X,progressVariant:"determinate",progressValue:L.length/H*100,onClick:()=>{A(!0),G([]),p.serviceFetch("dataset/rho/optimization/start",[],{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({optimize_iterations:j.optimizeIterations,sr_range:j.srRange,sr_interval_distance:j.srIntervalDistance,search_interval_distance:j.searchIntervalDistance,search_iterations:j.searchIterations,rho_range:[F,S]})}).then(e=>e.json()).then(e=>(K(e.max_iterations),null)).catch(e=>{console.error(e)}).then(()=>null).catch(e=>{console.error(e)})},children:"最適化を開始"})]}),(0,a.BX)(s.Z,{sx:{display:1===P?"block":"none",flexGrow:1,py:3},children:[(0,a.tZ)(c.Z,{component:"legend",sx:{display:"flex",alignItems:"center"},children:(0,a.tZ)("span",{style:{flexGrow:1},children:"選択範囲"})}),(0,a.BX)(u.Z,{children:[(0,a.tZ)(d.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(x.Ki,{disabled:es,label:"最小値",sx:{mt:1},value:F,onChange:e=>{T(e)},validator:(0,x.rB)(3),onFocus:()=>et(),onBlur:()=>er()})}),(0,a.tZ)(d.Z,{disableHoverListener:!0,title:"グラフ上で範囲選択できます。",children:(0,a.tZ)(x.Ki,{disabled:es,label:"最大値",sx:{mt:1},value:S,onChange:e=>{w(e)},validator:(0,x.rB)(3),onFocus:()=>et(),onBlur:()=>er()})})]}),(0,a.tZ)(_,{disabled:es,sx:{mt:3},fullWidth:!0,onClick:()=>{p.serviceFetch("dataset/rho/best",["range_min=".concat(F),"range_max=".concat(S)]).then(e=>e.json()).then(e=>{let{rho:t}=e;return M(t),null}).catch(e=>{console.error(e)})},children:"最小値を取得"})]}),(0,a.tZ)(h.Z,{sx:{mt:2}}),(0,a.tZ)(s.Z,{display:"flex",justifyContent:"center",alignItems:"center",children:(0,a.tZ)(v.Z,{color:"action",sx:{transform:"rotate(90deg)",my:2}})}),(0,a.tZ)(x.Ki,{disabled:es,label:"使用するρ",fullWidth:!0,value:z,onChange:e=>M(e),validator:(0,x.rB)(3)})]})]}),(0,a.tZ)(R.f,{primaryText:"SSR実行中",open:W})]})}},4326:function(e,t,r){"use strict";r.d(t,{Ki:function(){return o},rB:function(){return s}});var a=r(9241),n=r(3983);function s(e){return t=>parseFloat(Number(t).toPrecision(e))}let o=(0,r(2265).forwardRef)(function(e,t){let{label:r,value:s,onChange:o,onBlur:i=()=>{},validator:l,disabled:c,...u}=e,d=null!=l?l:e=>parseFloat(Number(e).toFixed(3));return(0,a.tZ)(n.Z,{disabled:c,ref:t,label:r,value:"number"==typeof s?d(s):s,onChange:e=>{o(e.target.value)},onBlur:e=>{o(d(e.target.value)),null==i||i()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&o(d(t.value))},...u})})},4671:function(e,t,r){"use strict";r.d(t,{L7:function(){return c},P2:function(){return i}});var a=r(9241),n=r(2265);let s=(0,n.createContext)({fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1}),o=(0,n.createContext)(()=>{}),i=()=>{let e=(0,n.useContext)(s),t=(0,n.useContext)(o);return[e,{setOptimizeIterations:e=>t({type:"setOptimizeIterations",payload:e}),setSrRange:e=>t({type:"setSrRange",payload:e}),setSrIntervalDistance:e=>t({type:"setSrIntervalDistance",payload:e}),setSearchIntervalDistance:e=>t({type:"setSearchIntervalDistance",payload:e}),setSearchIterations:e=>t({type:"setSearchIterations",payload:e}),setRhoMax:e=>t({type:"setRhoMax",payload:e}),setRhoMin:e=>t({type:"setRhoMin",payload:e}),setRho:e=>t({type:"setRho",payload:e})}]},l=(e,t)=>{switch(t.type){case"setFittingFunction":return{...e,fittingFunction:t.payload};case"setOptimizeIterations":return{...e,optimizeIterations:t.payload};case"setSrRange":return{...e,srRange:t.payload};case"setSrIntervalDistance":return{...e,srIntervalDistance:t.payload};case"setSearchIntervalDistance":return{...e,searchIntervalDistance:t.payload};case"setSearchIterations":return{...e,searchIterations:t.payload};case"setRhoMax":return{...e,rhoMax:t.payload};case"setRhoMin":return{...e,rhoMin:t.payload};case"setRho":return{...e,rho:t.payload};default:throw Error("Invalid action type")}};function c(e){let{children:t}=e,[r,i]=(0,n.useReducer)(l,{fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1});return(0,a.tZ)(s.Provider,{value:r,children:(0,a.tZ)(o.Provider,{value:i,children:t})})}}},function(e){e.O(0,[665,388,526,41,36,650,2,380,685,925,659,169,15,217,576,971,23,744],function(){return e(e.s=4437)}),_N_E=e.O()}]);