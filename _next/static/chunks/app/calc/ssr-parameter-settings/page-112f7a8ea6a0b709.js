(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{75:function(e,t,r){Promise.resolve().then(r.bind(r,9091))},9091:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var n=r(9241),a=r(1326),s=r(4990),i=r(511),o=r(8409),l=r(4526),c=r(4583),u=r(49),d=r(2265),p=r(7818),f=r(3098),h=r(6463),v=r(2331),g=r(3457),y=r(4326),m=r(9278),x=r(4671),S=r(4299),I=r(4980);let Z=(0,p.default)(()=>Promise.all([r.e(934),r.e(109),r.e(8)]).then(r.bind(r,2008)),{loadableGenerated:{webpack:()=>[2008]},ssr:!1});function w(){let e=(0,h.useRouter)(),[t,r]=(0,x.P2)(),[p]=(0,S.mN)(),w=p.apiClient,[k,b]=(0,d.useState)(10),[R,C]=(0,d.useState)(""),[D,_]=(0,d.useState)(""),[P,N]=(0,d.useState)(""),[M,F]=(0,d.useState)(!0),[L,A]=(0,d.useState)([0,0]),[z,B]=(0,d.useState)(0),[E,O]=(0,d.useState)([]),{setActiveStep:T}=(0,v.b)(),[X]=(0,I.Ay)(),G=X.originalDataset;return(0,d.useEffect)(()=>{M&&"string"!=typeof R&&w.serviceFetch("dataset/ssr/settings/preferred",["sr_interval_distance=".concat(R)]).then(e=>e.json()).then(e=>(_(e.search_interval_distance),N(e.search_iterations),null)).catch(e=>console.error(e))},[M,R]),(0,d.useEffect)(()=>{if(T(2),"loaded"!==X.status){e.push("/");return}let t=G.filter(e=>e.using),{samplesX:r}=t[0],n=r.map((e,r)=>t.map(e=>e.samplesY[r]).sort((e,t)=>e-t));O((0,m.T)(r,n)),w.serviceFetch("dataset/ssr/settings/preferred",[]).then(e=>e.json()).then(e=>(b(e.optimize_iterations),A(e.sr_range),C(e.sr_interval_distance),_(e.search_interval_distance),N(e.search_iterations),null)).catch(e=>console.error(e)),w.serviceFetch("dataset/ssr/settings/info",[]).then(e=>e.json()).then(e=>(B(e.original_interval_distance),null)).catch(e=>console.error(e))},[]),(0,n.tZ)(g.T,{onNext:()=>{if(X.isLocked){e.push("/calc/rho-optimize");return}"string"!=typeof R&&"string"!=typeof D&&"string"!=typeof P&&(r.setOptimizeIterations(k),r.setSrRange(L),r.setSrIntervalDistance(R),r.setSearchIntervalDistance(D),r.setSearchIterations(P),e.push("/calc/rho-optimize"))},onBack:()=>e.push("/calc/fitting"),children:(0,n.BX)(a.Z,{sx:{display:"grid",gap:1,height:{sm:"auto",md:"100%"},gridTemplateColumns:{sm:"1fr",md:"2fr 1fr"},gridTemplateRows:{sm:"1fr 1fr",md:"1fr"}},children:[(0,n.tZ)("div",{css:(0,f.iv)({display:"flex",justifyContent:"center"}),children:(0,n.tZ)(Z,{data:E,layout:{width:640,height:400}})}),(0,n.BX)(s.Z,{sx:{p:2,overflowY:"scroll"},children:[(0,n.tZ)(y.Ki,{label:"超解像度後の測定間隔",disabled:X.isLocked,fullWidth:!0,value:R,onChange:e=>{C(e)},validator:(0,y.rB)(3)}),(0,n.BX)(i.Z,{variant:"body2",sx:{mt:1},children:["超解像前の測定間隔:"," ",parseFloat(z.toFixed(3))]}),(0,n.BX)(o.Z,{component:"legend",sx:{mt:3,display:"flex",alignItems:"center"},children:[(0,n.tZ)("span",{style:{flexGrow:1},children:"θ探索"}),(0,n.tZ)(l.Z,{disabled:X.isLocked,control:(0,n.tZ)(c.Z,{checked:M,onChange:e=>{F(e.target.checked)}}),label:"Auto",labelPlacement:"start"})]}),(0,n.BX)(u.Z,{children:[(0,n.tZ)(y.Ki,{disabled:X.isLocked||M,label:"探索間隔",sx:{mt:1},value:D,onChange:e=>{_(e)},validator:(0,y.rB)(3)}),(0,n.tZ)(y.Ki,{disabled:X.isLocked||M,label:"探索点数",sx:{mt:1},value:P,onChange:e=>{N(e)}})]})]})]})})}},2331:function(e,t,r){"use strict";r.d(t,{I:function(){return a},b:function(){return s}});var n=r(2265);let a=n.createContext(void 0),s=()=>{let e=(0,n.useContext)(a);if(!e)throw Error("useAppContext must be used within an AppProvider");return e}},4326:function(e,t,r){"use strict";r.d(t,{Ki:function(){return i},rB:function(){return s}});var n=r(9241),a=r(3983);function s(e){return t=>parseFloat(Number(t).toPrecision(e))}let i=(0,r(2265).forwardRef)(function(e,t){let{label:r,value:s,onChange:i,onBlur:o=()=>{},validator:l,disabled:c,...u}=e,d=null!=l?l:e=>parseFloat(Number(e).toFixed(3));return(0,n.tZ)(a.Z,{disabled:c,ref:t,label:r,value:"number"==typeof s?d(s):s,onChange:e=>{i(e.target.value)},onBlur:e=>{i(d(e.target.value)),null==o||o()},onKeyDown:e=>{let t=e.target;"Enter"===e.key&&i(d(t.value))},...u})})},3457:function(e,t,r){"use strict";r.d(t,{T:function(){return i}});var n=r(9241),a=r(1326),s=r(6548);function i(e){let{children:t,onNext:r,onBack:i}=e;return(0,n.BX)(a.Z,{sx:{flexGrow:1,boxSizing:"border-box",overflow:"auto",display:"flex",flexDirection:"column"},children:[(0,n.tZ)(a.Z,{sx:{padding:2,overflowY:"overlay",flexGrow:1},children:t}),(0,n.BX)(a.Z,{sx:{display:"flex",justifyContent:"flex-end",p:1},children:[(0,n.tZ)(s.Z,{sx:{m:1},variant:"outlined",onClick:i,disabled:!i,children:"もどる"}),(0,n.tZ)(s.Z,{sx:{m:1},variant:"contained",onClick:r,disabled:!r,children:"つぎへ"})]})]})}i.defaultProps={onNext:void 0,onBack:void 0}},9278:function(e,t,r){"use strict";r.d(t,{T:function(){return s}});var n=r(2592);function a(e,t){let r=t/100*(e.length-1),n=Math.floor(r),a=n+1,s=r%1;return a>=e.length?e[n]:e[n]*(1-s)+e[a]*s}function s(e,t){let r={x:[...e,...e.toReversed()],y:[...t.map(e=>a(e,0)),...t.map(e=>a(e,100)).reverse()],fill:"toself",fillcolor:n.Z[50],line:{width:0},type:"scatter",showlegend:!1},s={x:[...e,...e.toReversed()],y:[...t.map(e=>a(e,10)),...t.map(e=>a(e,90)).reverse()],fill:"toself",fillcolor:n.Z[100],line:{width:0},type:"scatter",showlegend:!1},i={x:[...e,...e.toReversed()],y:[...t.map(e=>a(e,20)),...t.map(e=>a(e,80)).reverse()],fill:"toself",fillcolor:n.Z[200],line:{width:0},type:"scatter",showlegend:!1};return[r,s,i,{x:[...e,...e.toReversed()],y:[...t.map(e=>a(e,30)),...t.map(e=>a(e,70)).reverse()],fill:"toself",fillcolor:n.Z[300],line:{width:0},type:"scatter",showlegend:!1},{x:[...e,...e.toReversed()],y:[...t.map(e=>a(e,40)),...t.map(e=>a(e,60)).reverse()],fill:"toself",fillcolor:n.Z[400],line:{width:0},type:"scatter",showlegend:!1},{x:e,y:null==t?void 0:t.map(e=>a(e,50)),mode:"lines",marker:{color:n.Z[500]},showlegend:!1}]}},4980:function(e,t,r){"use strict";r.d(t,{Ay:function(){return o},GX:function(){return c}});var n=r(9241),a=r(2265);let s=(0,a.createContext)({status:"unset",name:"",originalDataset:[],isLocked:!0}),i=(0,a.createContext)(()=>{}),o=()=>{let e=(0,a.useContext)(s),t=(0,a.useContext)(i);return[e,(0,a.useMemo)(()=>({setName:e=>{t({type:"setName",payload:e})},setOriginalDataset:e=>{t({type:"setOriginalDataset",payload:e})},setDatasetStatus:e=>{t({type:"setDatasetStatus",payload:e})},setIsLocked:e=>{t({type:"setIsLocked",payload:e})}}),[])]},l=(e,t)=>{switch(t.type){case"setName":return{...e,name:t.payload};case"setOriginalDataset":return{...e,originalDataset:t.payload};case"setDatasetStatus":return{...e,status:t.payload};case"setIsLocked":return{...e,isLocked:t.payload};default:return e}};function c(e){let{children:t}=e,[r,o]=(0,a.useReducer)(l,{status:"unset",name:"",originalDataset:[],isLocked:!0});return(0,n.tZ)(s.Provider,{value:r,children:(0,n.tZ)(i.Provider,{value:o,children:t})})}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return g},NZ:function(){return u},ZP:function(){return s},mN:function(){return h},xh:function(){return i}});var n=r(9241),a=r(2265);let s="ap-northeast-3_K70QvMlqR",i="66f3b23k8hv9ne8poim1b2d8p",o="https://n2cs0lys69.execute-api.ap-northeast-3.amazonaws.com/prod",l="".concat(o,"/services/current"),c={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。"};async function u(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,n=t.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return c[r]||n}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let d=(0,a.createContext)({apiClient:v(o,l,null),apiGatewayUrl:o,serviceStatus:"configuring"}),p=(0,a.createContext)(()=>{}),f=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,h=()=>{let e=(0,a.useContext)(d),t=(0,a.useContext)(p);return(0,a.useRef)(e).current=e,[e,(0,a.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function v(e,t,r){let n=async(e,n,a)=>{r&&n.push("token=".concat(r));let s=n.length>0?"?"+n.join("&"):"";return fetch("".concat(t,"/").concat(e).concat(s),a)};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>n(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await n("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function g(e){let{children:t}=e,r=(0,a.useMemo)(()=>v(o,l,null),[]),[s,i]=(0,a.useReducer)(f,{apiClient:r,apiGatewayUrl:o,serviceStatus:"configuring"}),c=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{if(!c.current)return async function(){try{let e=await s.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?i({type:"setServiceStatus",payload:{status:"connected"}}):i({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),i({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{c.current=!0}},[]),(0,n.tZ)(d.Provider,{value:s,children:(0,n.tZ)(p.Provider,{value:i,children:t})})}},4671:function(e,t,r){"use strict";r.d(t,{L7:function(){return c},P2:function(){return o}});var n=r(9241),a=r(2265);let s=(0,a.createContext)({fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1}),i=(0,a.createContext)(()=>{}),o=()=>{let e=(0,a.useContext)(s),t=(0,a.useContext)(i);return[e,{setOptimizeIterations:e=>t({type:"setOptimizeIterations",payload:e}),setSrRange:e=>t({type:"setSrRange",payload:e}),setSrIntervalDistance:e=>t({type:"setSrIntervalDistance",payload:e}),setSearchIntervalDistance:e=>t({type:"setSearchIntervalDistance",payload:e}),setSearchIterations:e=>t({type:"setSearchIterations",payload:e}),setRhoMax:e=>t({type:"setRhoMax",payload:e}),setRhoMin:e=>t({type:"setRhoMin",payload:e}),setRho:e=>t({type:"setRho",payload:e})}]},l=(e,t)=>{switch(t.type){case"setFittingFunction":return{...e,fittingFunction:t.payload};case"setOptimizeIterations":return{...e,optimizeIterations:t.payload};case"setSrRange":return{...e,srRange:t.payload};case"setSrIntervalDistance":return{...e,srIntervalDistance:t.payload};case"setSearchIntervalDistance":return{...e,searchIntervalDistance:t.payload};case"setSearchIterations":return{...e,searchIterations:t.payload};case"setRhoMax":return{...e,rhoMax:t.payload};case"setRhoMin":return{...e,rhoMin:t.payload};case"setRho":return{...e,rho:t.payload};default:throw Error("Invalid action type")}};function c(e){let{children:t}=e,[r,o]=(0,a.useReducer)(l,{fittingFunction:"",peakRange:[],noiseRange:[],optimizeIterations:0,srIntervalDistance:0,searchIntervalDistance:0,searchIterations:0,rhoMax:0,rhoMin:0,searchSettingsAuto:!0,rhoSettingsAuto:!0,srRange:[0,0],originalIntervalDistance:0,plotData:[],progressIndicatorActive:!1});return(0,n.tZ)(s.Provider,{value:r,children:(0,n.tZ)(i.Provider,{value:o,children:t})})}}},function(e){e.O(0,[388,526,650,2,380,685,659,169,821,971,23,744],function(){return e(e.s=75)}),_N_E=e.O()}]);