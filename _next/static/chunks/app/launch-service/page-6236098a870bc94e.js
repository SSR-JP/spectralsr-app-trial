(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{2076:function(t,e,r){Promise.resolve().then(r.bind(r,4027))},4027:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return Z}});var n=r(9241),o=r(4299),s=r(1096),a=r(9128),c=r(824),i=r(385),u=r(64),l=r(9889),h=r(5734),f=r(6393),d=r(511),p=r(6463),v=r(5041),w=r(2265);async function y(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;for(let o=0;o<r;o+=1)try{let r=await fetch("".concat(t,"/services?token=").concat(e));if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let n=await r.json();if("ATTACHED"!=n.status)throw Error("Service not launched yet. status: ".concat(n.status));return n}catch(t){if(o===r-1)throw t;await new Promise(t=>setTimeout(t,n))}throw Error("fetchWithRetry: should be unreachable")}async function m(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;for(let n=0;n<e;++n)try{let e=await t.serviceFetch("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));return e}catch(t){if(n===e-1)throw t;await new Promise(t=>setTimeout(t,r))}throw Error("fetchWithRetry: should be unreachable")}function Z(){let[t,e]=(0,o.mN)(),r=t.apiClient,[Z,S]=(0,w.useState)(0),g=(0,w.useRef)(!1),k=(0,p.useRouter)();return(0,w.useEffect)(()=>{if(g.current)return;g.current=!0;let n=r.getAccessToken();if(console.log("accessToken",n),!n){(0,v.yv)("ログインしてください",{variant:"error"});return}let o=t.apiGatewayUrl;(async()=>{try{let t=await fetch("".concat(o,"/services/launch?token=").concat(n),{method:"POST"});if(!t.ok){let e=await t.text();throw Error("HTTP error! status: ".concat(t.status,", ").concat(e))}await t.json()}catch(t){console.error(t),(0,v.yv)("サービスの起動に失敗しました",{variant:"error"});return}try{await y(o,n,12,5e3)}catch(t){console.error(t),(0,v.yv)("サービスの起動に失敗しました",{variant:"error"});return}await new Promise(t=>setTimeout(t,2e3)),S(1),await new Promise(t=>setTimeout(t,5e3)),S(2);try{await m(r,12,5e3)}catch(t){console.error(t),(0,v.yv)("サービスの起動に失敗しました",{variant:"error"});return}await new Promise(t=>setTimeout(t,2e3)),S(3),await new Promise(t=>setTimeout(t,2e3)),e.setServiceStatus("connected"),k.push("/calc/data-cleansing")})()},[]),(0,n.BX)(s.Z,{open:!0,sx:{"& .MuiDialog-paper":{borderRadius:3,position:"relative"}},children:[(0,n.tZ)(a.Z,{sx:{position:"absolute",top:0,left:0,right:0}}),(0,n.tZ)(c.Z,{children:"計算サービス接続中..."}),(0,n.tZ)(i.Z,{children:(0,n.BX)(u.Z,{activeStep:Z,orientation:"vertical",children:[(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス起動中"})}),(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス起動完了"})}),(0,n.BX)(l.Z,{children:[(0,n.tZ)(h.Z,{children:"サービス接続中"}),(0,n.tZ)(f.Z,{children:(0,n.tZ)(d.Z,{children:"1分程度かかる場合があります..."})})]}),(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス接続完了"})})]})})]})}},4299:function(t,e,r){"use strict";r.d(e,{Er:function(){return w},NZ:function(){return l},ZP:function(){return s},mN:function(){return p},xh:function(){return a}});var n=r(9241),o=r(2265);let s="ap-northeast-3_K70QvMlqR",a="66f3b23k8hv9ne8poim1b2d8p",c="https://n2cs0lys69.execute-api.ap-northeast-3.amazonaws.com/prod",i="".concat(c,"/services/current"),u={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。"};async function l(t){if(t.ok)return;if(404===t.status)return"通信先が見つかりませんでした(404)。";let e=await t.text();try{let t=JSON.parse(e);console.log(t);let r=function(t){if(void 0==t)return;let e=t.detail;if(void 0==e)return;let r=e.code,n=e.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return u[r]||n}(t);if(void 0!=r)return r}catch(t){console.warn("Failed to parse error response",t)}return"エラーが発生しました。".concat(t.status,": ").concat(e)}let h=(0,o.createContext)({apiClient:v(c,i,null),apiGatewayUrl:c,serviceStatus:"configuring"}),f=(0,o.createContext)(()=>{}),d=(t,e)=>"setServiceStatus"===e.type?{...t,serviceStatus:e.payload.status}:t,p=()=>{let t=(0,o.useContext)(h),e=(0,o.useContext)(f);return(0,o.useRef)(t).current=t,[t,(0,o.useMemo)(()=>({setServiceStatus:t=>{e({type:"setServiceStatus",payload:{status:t}})}}),[])]};function v(t,e,r){let n=async(t,n,o)=>{r&&n.push("token=".concat(r));let s=n.length>0?"?"+n.join("&"):"";return fetch("".concat(e,"/").concat(t).concat(s),o)};return console.log("makeApiClient()"),{serviceFetch:async(t,e,r)=>n(t,e,r),setNewAccessToken:t=>{r=t,localStorage.setItem("token",t)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let t=await n("hello",[]);if(!t.ok)throw Error("HTTP error! status: ".concat(t.status))}catch(t){return console.error(t),!1}return!0}}}function w(t){let{children:e}=t,r=(0,o.useMemo)(()=>v(c,i,null),[]),[s,a]=(0,o.useReducer)(d,{apiClient:r,apiGatewayUrl:c,serviceStatus:"configuring"}),u=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(!u.current)return async function(){try{let t=await s.apiClient.restoreServiceSession();console.log("restoreServiceSession",t),t?a({type:"setServiceStatus",payload:{status:"connected"}}):a({type:"setServiceStatus",payload:{status:"not-login"}})}catch(t){console.error(t),a({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{u.current=!0}},[]),(0,n.tZ)(h.Provider,{value:s,children:(0,n.tZ)(f.Provider,{value:a,children:e})})}}},function(t){t.O(0,[388,526,41,2,273,373,555,971,23,744],function(){return t(t.s=2076)}),_N_E=t.O()}]);