(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[995],{2076:function(e,t,r){Promise.resolve().then(r.bind(r,4027))},4027:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Z}});var n=r(9241),o=r(4299),a=r(1096),s=r(9128),i=r(824),c=r(385),u=r(64),l=r(9889),h=r(5734),f=r(6393),d=r(511),v=r(6463),p=r(5041),w=r(2265);async function y(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3;for(let o=0;o<r;o+=1)try{let r=await fetch("".concat(e,"/services"),{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let n=await r.json();if("ATTACHED"!=n.status)throw Error("Service not launched yet. status: ".concat(n.status));return n}catch(e){if(o===r-1)throw e;await new Promise(e=>setTimeout(e,n))}throw Error("fetchWithRetry: should be unreachable")}async function m(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3;for(let n=0;n<t;++n)try{let t=await e.serviceFetch("hello",[]);if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return t}catch(e){if(n===t-1)throw e;await new Promise(e=>setTimeout(e,r))}throw Error("fetchWithRetry: should be unreachable")}function Z(){let[e,t]=(0,o.mN)(),r=e.apiClient,[Z,S]=(0,w.useState)(0),g=(0,w.useRef)(!1),T=(0,v.useRouter)();return(0,w.useEffect)(()=>{if(g.current)return;g.current=!0;let n=r.getAccessToken();if(console.log("accessToken",n),!n){(0,p.yv)("ログインしてください",{variant:"error"});return}let o=e.apiGatewayUrl;(async()=>{try{let e=await fetch("".concat(o,"/services/launch"),{method:"POST",headers:{Authorization:"Bearer ".concat(n)}});if(!e.ok){let t=await e.text();throw Error("HTTP error! status: ".concat(e.status,", ").concat(t))}await e.json()}catch(e){console.error(e),(0,p.yv)("サービスの起動に失敗しました",{variant:"error"});return}try{await y(o,n,12,5e3)}catch(e){console.error(e),(0,p.yv)("サービスの起動に失敗しました",{variant:"error"});return}await new Promise(e=>setTimeout(e,2e3)),S(1),await new Promise(e=>setTimeout(e,5e3)),S(2);try{await m(r,12,5e3)}catch(e){console.error(e),(0,p.yv)("サービスの起動に失敗しました",{variant:"error"});return}await new Promise(e=>setTimeout(e,2e3)),S(3),await new Promise(e=>setTimeout(e,2e3)),t.setServiceStatus("connected"),T.push("/calc/data-cleansing")})()},[]),(0,n.BX)(a.Z,{open:!0,sx:{"& .MuiDialog-paper":{borderRadius:3,position:"relative"}},children:[(0,n.tZ)(s.Z,{sx:{position:"absolute",top:0,left:0,right:0}}),(0,n.tZ)(i.Z,{children:"計算サービス接続中..."}),(0,n.tZ)(c.Z,{children:(0,n.BX)(u.Z,{activeStep:Z,orientation:"vertical",children:[(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス起動中"})}),(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス起動完了"})}),(0,n.BX)(l.Z,{children:[(0,n.tZ)(h.Z,{children:"サービス接続中"}),(0,n.tZ)(f.Z,{children:(0,n.tZ)(d.Z,{children:"1分程度かかる場合があります..."})})]}),(0,n.tZ)(l.Z,{children:(0,n.tZ)(h.Z,{children:"サービス接続完了"})})]})})]})}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return w},NZ:function(){return l},ZP:function(){return a},mN:function(){return v},xh:function(){return s}});var n=r(9241),o=r(2265);let a="ap-northeast-3_K70QvMlqR",s="66f3b23k8hv9ne8poim1b2d8p",i="https://n2cs0lys69.execute-api.ap-northeast-3.amazonaws.com/prod",c="".concat(i,"/services/current"),u={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。"};async function l(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,n=t.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return u[r]||n}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let h=(0,o.createContext)({apiClient:p(i,c,null),apiGatewayUrl:i,serviceStatus:"configuring"}),f=(0,o.createContext)(()=>{}),d=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,v=()=>{let e=(0,o.useContext)(h),t=(0,o.useContext)(f);return(0,o.useRef)(e).current=e,[e,(0,o.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function p(e,t,r){let n=async(e,n,o)=>{let a=n.length>0?"?"+n.join("&"):"",s="".concat(t,"/").concat(e).concat(a),i=new Headers(null==o?void 0:o.headers);return r&&i.set("Authorization","Bearer ".concat(r)),fetch(s,{...o,headers:i})};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>n(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await n("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function w(e){let{children:t}=e,r=(0,o.useMemo)(()=>p(i,c,null),[]),[a,s]=(0,o.useReducer)(d,{apiClient:r,apiGatewayUrl:i,serviceStatus:"configuring"}),u=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(!u.current)return async function(){try{let e=await a.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?s({type:"setServiceStatus",payload:{status:"connected"}}):s({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),s({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{u.current=!0}},[]),(0,n.tZ)(h.Provider,{value:a,children:(0,n.tZ)(f.Provider,{value:s,children:t})})}}},function(e){e.O(0,[388,526,41,2,273,373,555,971,23,744],function(){return e(e.s=2076)}),_N_E=e.O()}]);