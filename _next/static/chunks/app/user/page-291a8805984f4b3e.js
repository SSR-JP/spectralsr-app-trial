(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3797],{6102:function(e,t,r){Promise.resolve().then(r.bind(r,365))},365:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return P}});var n=r(9241),o=r(4299),a=r(3460),i=r(9998),c=r(6091),s=r(415),l=r(3098),u=r(8153),d=r(1527),p=r(1638),f=r(9627),h=r(1733),m=r(2305),v=r(9806),g=r(335),y=r(511),Z=r(6548),x=r(6463),b=r(5041),S=r(2265);function P(){let[e]=(0,a.fl)(),t=(0,u.PQ)(u.YI.primary.getArgb(e.scheme)),r=(0,u.PQ)(u.YI.surface.getArgb(e.scheme)),P=(0,u.PQ)(u.YI.surfaceContainer.getArgb(e.scheme));(0,u.PQ)(u.YI.onSurface.getArgb(e.scheme));let C=(0,u.PQ)(u.YI.onSurfaceVariant.getArgb(e.scheme)),k=(0,x.useRouter)(),[w,E]=(0,S.useState)("---"),[B]=(0,o.mN)(),{waitingForPayment:I,purchaseRunning:A,handlePurchase:T,handleCancelPayment:_}=(0,c.s)({onPaymentSuccess:()=>{R()}}),R=async()=>{let e=B.apiGatewayUrl,t=B.apiClient.getAccessToken();try{let r=await fetch("".concat(e,"/tickets/balance"),{headers:{Authorization:"Bearer ".concat(t)}});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));let n=await r.json();E(n.ticket_balance.toFixed(0))}catch(e){console.error("Failed to fetch ticket count:",e),(0,b.yv)("チケットの取得に失敗しました。",{variant:"error"})}};return(0,S.useEffect)(()=>{"connected"===B.serviceStatus&&(s.e.isProdTrialMode||R())},[B.serviceStatus]),(0,n.BX)("div",{css:(0,l.iv)({}),children:[(0,n.tZ)(h.Z,{position:"fixed",elevation:0,css:(0,l.iv)({backgroundColor:(0,m.Fq)(r,.5),backdropFilter:"blur(16px)",color:t}),children:(0,n.BX)(v.Z,{children:[(0,n.tZ)(g.Z,{size:"large",edge:"start",color:"inherit",onClick:()=>{k.back()},children:(0,n.tZ)(d.Z,{})}),(0,n.tZ)(y.Z,{variant:"h6",css:(0,l.iv)({fontWeight:"bold"}),children:"ユーザ情報"})]})}),(0,n.BX)("div",{css:(0,l.iv)({display:"flex",flexDirection:"column",marginTop:"80px",paddingLeft:"16px",paddingRight:"16px",marginLeft:"auto",marginRight:"auto",maxWidth:"1040px"}),children:[!s.e.isProdTrialMode&&(0,n.BX)(n.HY,{children:[(0,n.tZ)(y.Z,{variant:"h6",css:(0,l.iv)({fontWeight:"bold"}),children:"チケット"}),(0,n.BX)("div",{css:(0,l.iv)({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",maxWidth:"288px"}),children:[(0,n.BX)("div",{css:(0,l.iv)({alignItems:"center",alignSelf:"center",padding:"8px",display:"flex",flexDirection:"row"}),children:[(0,n.tZ)(p.Z,{}),(0,n.tZ)("span",{css:(0,l.iv)({}),children:"残り"}),(0,n.BX)("span",{css:(0,l.iv)({paddingLeft:"8px",fontSize:"24px"}),children:[w,"枚"]})]}),(0,n.tZ)(Z.Z,{css:(0,l.iv)({}),variant:"contained",onClick:T,disabled:A||I,children:I?"決済処理中...":A?"処理中...":"チケットを購入"})]})]}),(0,n.BX)("div",{css:(0,l.iv)({marginTop:s.e.isProdTrialMode?0:48,paddingBottom:32}),children:[(0,n.tZ)(y.Z,{variant:"h6",css:(0,l.iv)({fontWeight:"bold",marginBottom:16,display:"flex",alignItems:"center",gap:8}),children:"アプリ情報"}),(0,n.BX)("div",{css:(0,l.iv)({display:"flex",flexDirection:"column",gap:16,backgroundColor:P,padding:20,borderRadius:12}),children:[(0,n.BX)("div",{children:[(0,n.tZ)(y.Z,{variant:"subtitle2",css:(0,l.iv)({color:C,marginBottom:4}),children:"アプリ名"}),(0,n.tZ)(y.Z,{variant:"body1",children:"SpectralSR"})]}),(0,n.BX)("div",{children:[(0,n.tZ)(y.Z,{variant:"subtitle2",css:(0,l.iv)({color:C,marginBottom:4}),children:"バージョン"}),(0,n.tZ)(y.Z,{variant:"body1",children:"1.0.0-alpha"})]}),(0,n.BX)("div",{children:[(0,n.tZ)(y.Z,{variant:"subtitle2",css:(0,l.iv)({color:C,marginBottom:8}),children:"リンク"}),(0,n.BX)("div",{css:(0,l.iv)({display:"flex",flexDirection:"column",gap:12}),children:[(0,n.BX)("a",{href:"https://spectralsr.com/",target:"_blank",rel:"noopener noreferrer",css:(0,l.iv)({color:t,textDecoration:"none",fontSize:"16px",display:"flex",alignItems:"center",gap:4,"&:hover":{textDecoration:"underline"}}),children:["ホームページ ",(0,n.tZ)(f.Z,{fontSize:"small"})]}),(0,n.BX)("a",{href:"https://spectralsr.com/spectrumdir/wp-content/uploads/SSRKK_Privacy-policy_20250625.pdf",target:"_blank",rel:"noopener noreferrer",css:(0,l.iv)({color:t,textDecoration:"none",fontSize:"16px",display:"flex",alignItems:"center",gap:4,"&:hover":{textDecoration:"underline"}}),children:["プライバシーポリシー ",(0,n.tZ)(f.Z,{fontSize:"small"})]})]})]})]})]})]}),I&&(0,n.tZ)(i.Z,{onCancel:_})]})}},9998:function(e,t,r){"use strict";r.d(t,{Z:function(){return g}});var n=r(9241),o=r(3460),a=r(3098),i=r(8153),c=r(9337),s=r(137),l=r(4593),u=r(2305),d=r(270),p=r(4696),f=r(335),h=r(468),m=r(511),v=r(6548);function g(e){let{onCancel:t}=e,[r]=(0,o.fl)(),g=(0,i.PQ)(i.YI.primary.getArgb(r.scheme));(0,i.PQ)(i.YI.surface.getArgb(r.scheme));let y=(0,i.PQ)(i.YI.surfaceContainer.getArgb(r.scheme));return(0,n.tZ)(l.Z,{open:!0,css:(0,a.iv)({zIndex:9999,backgroundColor:(0,u.Fq)("#000",.7),backdropFilter:"blur(4px)"}),children:(0,n.tZ)(d.Z,{css:(0,a.iv)({backgroundColor:y,maxWidth:"400px",width:"90%",margin:"0 16px"}),children:(0,n.BX)(p.Z,{css:(0,a.iv)({display:"flex",flexDirection:"column",alignItems:"center",padding:"32px",textAlign:"center",position:"relative"}),children:[(0,n.tZ)(f.Z,{onClick:t,css:(0,a.iv)({position:"absolute",top:"8px",right:"8px"}),children:(0,n.tZ)(c.Z,{})}),(0,n.tZ)(s.Z,{css:(0,a.iv)({fontSize:"48px",color:g,marginBottom:"16px"})}),(0,n.tZ)(h.Z,{css:(0,a.iv)({color:g,marginBottom:"16px"})}),(0,n.tZ)(m.Z,{variant:"h6",css:(0,a.iv)({marginBottom:"8px"}),children:"決済処理中..."}),(0,n.tZ)(m.Z,{variant:"body1",css:(0,a.iv)({marginBottom:"16px"}),children:"新しいタブで決済を続行してください"}),(0,n.tZ)(m.Z,{variant:"body2",color:"textSecondary",css:(0,a.iv)({marginBottom:"24px"}),children:"決済が完了すると自動的にこの画面は閉じられます"}),(0,n.tZ)(v.Z,{variant:"outlined",onClick:t,css:(0,a.iv)({borderColor:g,color:g}),children:"キャンセル"})]})})})}},415:function(e,t,r){"use strict";r.d(t,{e:function(){return n}});let n={isProdTrialMode:!0}},6091:function(e,t,r){"use strict";r.d(t,{s:function(){return i}});var n=r(4299),o=r(5041),a=r(2265);let i=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,r]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),s=(0,a.useRef)(null),l=(0,a.useRef)(null),[u]=(0,n.mN)();return(0,a.useEffect)(()=>("BroadcastChannel"in window&&(l.current=new BroadcastChannel("payment-status"),l.current.onmessage=t=>{if(console.log("Payment message received:",t.data),"PAYMENT_COMPLETE"===t.data.type){var n,a,i;if(r(!1),c(!1),"success"===t.data.status)(0,o.yv)("チケットの購入が完了しました！",{variant:"success"}),null===(n=e.onPaymentSuccess)||void 0===n||n.call(e);else if("cancel"===t.data.status)(0,o.yv)("支払いがキャンセルされました。",{variant:"info"}),null===(a=e.onPaymentCancel)||void 0===a||a.call(e);else if("error"===t.data.status){let t="支払いの処理中にエラーが発生しました。";(0,o.yv)(t,{variant:"error"}),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}}}),()=>{l.current&&l.current.close()}),[e]),(0,a.useEffect)(()=>{if(!t||!s.current)return;let e=setInterval(()=>{var t;(null===(t=s.current)||void 0===t?void 0:t.closed)&&(clearInterval(e),r(!1),c(!1),console.log("Payment tab was closed by user"))},1e3);return()=>clearInterval(e)},[t]),{waitingForPayment:t,purchaseRunning:i,handlePurchase:(0,a.useCallback)(async()=>{c(!0);let t=u.apiGatewayUrl,n=u.apiClient.getAccessToken(),a=window.location.origin;try{if(s.current=window.open("".concat(a,"/payment-prepare"),"_blank"),!s.current)throw Error("新しいタブを開けませんでした。ポップアップブロックを無効にしてください。");r(!0);let i=t=>{if("PAYMENT_PREPARE_READY"===t.data.type)console.log("Payment prepare page is ready"),l();else if("PAYMENT_CANCELED"===t.data.type){var n;console.log("Payment was canceled from prepare page"),r(!1),c(!1),null===(n=e.onPaymentCancel)||void 0===n||n.call(e)}},l=async()=>{try{let e=await fetch("".concat(t,"/payments/checkout-session"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify({success_url:"".concat(a,"/payment-success?session_id={CHECKOUT_SESSION_ID}"),cancel_url:"".concat(a,"/payment-cancel"),ticketQuantity:1})});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let r=await e.json();console.log("Checkout Session created:",r);let{checkout_url:o}=r;s.current&&!s.current.closed&&s.current.postMessage({type:"STRIPE_URL",url:o},"*")}catch(n){var i;console.error("Checkout session creation failed:",n),s.current&&!s.current.closed&&s.current.postMessage({type:"PAYMENT_ERROR",message:"決済ページの準備に失敗しました。"},"*");let t="購入に失敗しました。もう一度お試しください。";(0,o.yv)(t,{variant:"error"}),c(!1),r(!1),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}};window.addEventListener("message",i),setTimeout(()=>{window.removeEventListener("message",i)},6e4)}catch(r){var i;console.error("Purchase failed:",r);let t=r instanceof Error&&r.message.includes("タブ")?r.message:"購入に失敗しました。もう一度お試しください。";(0,o.yv)(t,{variant:"error"}),c(!1),null===(i=e.onPaymentError)||void 0===i||i.call(e,t)}},[u,e]),handleCancelPayment:(0,a.useCallback)(()=>{s.current&&!s.current.closed&&s.current.close(),r(!1),c(!1)},[])}}},4299:function(e,t,r){"use strict";r.d(t,{Er:function(){return v},NZ:function(){return u},ZP:function(){return a},mN:function(){return h},xh:function(){return i}});var n=r(9241),o=r(2265);let a="ap-northeast-3_K70QvMlqR",i="66f3b23k8hv9ne8poim1b2d8p",c="https://n2cs0lys69.execute-api.ap-northeast-3.amazonaws.com/prod",s="".concat(c,"/services/current"),l={"ssr.broken-database":"データベースが破損しています。","ssr.incompatible-extension":"データに互換性のない拡張子が含まれています。","ssr.extension-unmatched":"拡張子が一致しません。","ssr.load-failure":"データの読み込みに失敗しました。","ssr.incompatible-npl":"データのNPLスタイルが互換性がありません。","ssr.file-info-unmatched":"ファイル間でNPL情報が統一されていません。","ssr.data-info-unmatched":"データ間でNPL情報が統一されていません。","ssr.data-size-unmatched":"データ間でサイズが統一されていません。","ssr.incorrect-parameters":"パラメータの指定が正しくありません。","ssr.get-mean-failure":"平均値の取得に失敗しました。","ssr.fitting-failure":"フィッティングに失敗しました。","ssr.wrong-fitting-result":"フィッティング結果が妥当ではありません。","ssr.out-of-memory":"メモリ不足です。","ssr.grid-contains-outside":"予想される位置が範囲外に含まれています。","ssr.others":"不明なエラーが発生しました。","ticket.consume-failed":"計算チケットが不足しています。"};async function u(e){if(e.ok)return;if(404===e.status)return"通信先が見つかりませんでした(404)。";let t=await e.text();try{let e=JSON.parse(t);console.log(e);let r=function(e){if(void 0==e)return;let t=e.detail;if(void 0==t)return;let r=t.code,n=t.message;if(void 0!=r&&void 0!=n&&"string"==typeof r&&"string"==typeof n)return l[r]||n}(e);if(void 0!=r)return r}catch(e){console.warn("Failed to parse error response",e)}return"エラーが発生しました。".concat(e.status,": ").concat(t)}let d=(0,o.createContext)({apiClient:m(c,s,null),apiGatewayUrl:c,serviceStatus:"configuring"}),p=(0,o.createContext)(()=>{}),f=(e,t)=>"setServiceStatus"===t.type?{...e,serviceStatus:t.payload.status}:e,h=()=>{let e=(0,o.useContext)(d),t=(0,o.useContext)(p);return(0,o.useRef)(e).current=e,[e,(0,o.useMemo)(()=>({setServiceStatus:e=>{t({type:"setServiceStatus",payload:{status:e}})}}),[])]};function m(e,t,r){let n=async(e,n,o)=>{let a=n.length>0?"?"+n.join("&"):"",i="".concat(t,"/").concat(e).concat(a),c=new Headers(null==o?void 0:o.headers);return r&&c.set("Authorization","Bearer ".concat(r)),fetch(i,{...o,headers:c})};return console.log("makeApiClient()"),{serviceFetch:async(e,t,r)=>n(e,t,r),setNewAccessToken:e=>{r=e,localStorage.setItem("token",e)},getAccessToken:()=>r,restoreServiceSession:async()=>{r=localStorage.getItem("token");try{let e=await n("hello",[]);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status))}catch(e){return console.error(e),!1}return!0}}}function v(e){let{children:t}=e,r=(0,o.useMemo)(()=>m(c,s,null),[]),[a,i]=(0,o.useReducer)(f,{apiClient:r,apiGatewayUrl:c,serviceStatus:"configuring"}),l=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{if(!l.current)return async function(){try{let e=await a.apiClient.restoreServiceSession();console.log("restoreServiceSession",e),e?i({type:"setServiceStatus",payload:{status:"connected"}}):i({type:"setServiceStatus",payload:{status:"not-login"}})}catch(e){console.error(e),i({type:"setServiceStatus",payload:{status:"not-login"}})}}(),()=>{l.current=!0}},[]),(0,n.tZ)(d.Provider,{value:a,children:(0,n.tZ)(p.Provider,{value:i,children:t})})}},3460:function(e,t,r){"use strict";r.d(t,{ThemeStoreProvider:function(){return v},fl:function(){return h}});var n=r(9241),o=r(8438),a=r.n(o),i=r(9380),c=r(2686),s=r(1705),l=r(8153),u=r(2265),d=r(1246);let p=(0,u.createContext)({scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),f=(0,u.createContext)(()=>{}),h=()=>{let e=(0,u.useContext)(p),t=(0,u.useContext)(f);return[e,{resetSourceColor:()=>{t({type:"setTheme",payload:{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}})}}]},m=(e,t)=>{if("setTheme"===t.type){let{scheme:r,sourceColor:n}=t.payload;return e.sourceColor===n?e:{...e,scheme:r,sourceColor:n}}return e},v=e=>{let{children:t}=e,[r,o]=(0,u.useReducer)(m,{scheme:new l.S2(l.OP.fromInt(4435848),!1,-1),sourceColor:4435848}),h=(0,i.Z)((0,c.Z)({palette:{mode:"light",primary:{main:(0,l.PQ)(l.YI.primary.getArgb(r.scheme))},secondary:{main:(0,l.PQ)(l.YI.secondary.getArgb(r.scheme))},background:{default:(0,l.PQ)(l.YI.surface.getArgb(r.scheme)),paper:(0,l.PQ)(l.YI.surfaceContainer.getArgb(r.scheme))},error:{main:(0,l.PQ)(l.YI.error.getArgb(r.scheme))},text:{primary:(0,l.PQ)(l.YI.onSurface.getArgb(r.scheme))}},typography:{fontFamily:a().style.fontFamily}}));return(0,n.BX)(s.Z,{theme:h,children:[(0,n.tZ)(d.Z,{styles:e=>({body:{transition:e.transitions.create(["background-color","transform"])}})}),(0,n.tZ)(p.Provider,{value:r,children:(0,n.tZ)(f.Provider,{value:o,children:t})})]})}}},function(e){e.O(0,[1665,9241,526,2036,819,6548,3676,152,933,6123,2971,7023,1744],function(){return e(e.s=6102)}),_N_E=e.O()}]);